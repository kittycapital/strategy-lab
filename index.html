<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì „ëµ ì—°êµ¬ â€” ë©€í‹° ìì‚° íˆ¬ì ì‹œë®¬ë ˆì´í„°</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="data.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg0:#000;--bg1:#07070d;--bg2:#0d0d16;--bg3:#13131f;--bg4:#1a1a2a;
  --bdr:#1a1a2e;--bdr2:#282845;
  --t1:#e8e8f0;--t2:#b0b0c8;--t3:#8888a0;--t4:#686880;
  --g:#00ff88;--gd:#00cc6a;--r:#ff4466;--b:#4488ff;--y:#ffcc00;--p:#aa66ff;--c:#00ccee;--o:#ff8844;
}
body{background:var(--bg0);color:var(--t1);font-family:'Noto Sans KR',system-ui,sans-serif;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg1)}::-webkit-scrollbar-thumb{background:var(--bdr2);border-radius:3px}
a{color:var(--g);text-decoration:none}
.hdr{padding:12px 28px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:center;background:var(--bg1);flex-wrap:wrap;gap:12px}
.logo{display:flex;align-items:center;gap:10px}
.logo-t{font-weight:700;font-size:15px;color:#fff;margin-right:16px}
.tabs{display:flex;gap:3px;background:var(--bg2);border-radius:9px;padding:3px;border:1px solid var(--bdr)}
.tab{padding:7px 16px;border-radius:7px;cursor:pointer;font-size:12px;font-weight:500;color:var(--t2);border:none;background:none;white-space:nowrap;transition:.15s;font-family:inherit}
.tab:hover{color:var(--t1);background:var(--bg3)}
.tab.on{background:var(--g);color:#000;font-weight:700}
.main{padding:20px 28px;max-width:1400px;margin:0 auto}
.sim-layout{display:grid;grid-template-columns:300px 1fr;gap:20px}
.sidebar{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:16px;height:fit-content;position:sticky;top:16px}
.stitle{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t4);margin:14px 0 8px}.stitle:first-child{margin-top:0}
.agrid{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.achip{padding:5px 6px;border:1px solid var(--bdr);border-radius:5px;cursor:pointer;font-size:10px;font-weight:500;text-align:center;background:var(--bg1);color:var(--t3);transition:.12s}
.achip:hover{border-color:var(--bdr2);color:var(--t1)}
.achip.on{border-color:var(--g);background:rgba(0,255,136,.07);color:var(--g)}
.achip.dis{opacity:.25;cursor:not-allowed}
.catlbl{grid-column:1/-1;font-size:9px;color:var(--t4);padding:3px 0 1px;font-weight:700;letter-spacing:.5px}
.sbtn{padding:8px 10px;border:1px solid var(--bdr);border-radius:7px;cursor:pointer;font-size:11px;background:var(--bg1);color:var(--t2);transition:.12s;text-align:left;display:flex;flex-direction:column;margin-bottom:5px}
.sbtn:hover{border-color:var(--bdr2);color:var(--t1)}
.sbtn.on{border-color:var(--g);background:rgba(0,255,136,.05);color:var(--t1)}
.sbtn .lb{font-weight:700;font-size:12px}.sbtn .ds{font-size:9px;color:var(--t4);margin-top:1px}
.sgrp{margin-bottom:12px}
.shdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.slbl{font-size:11px;color:var(--t2)}
.sval{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;color:var(--g)}
input[type=range]{width:100%;-webkit-appearance:none;height:3px;background:var(--bdr);border-radius:2px;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--g);border-radius:50%;cursor:pointer;box-shadow:0 0 6px rgba(0,255,136,.3)}
select{width:100%;padding:7px 9px;background:var(--bg1);border:1px solid var(--bdr);border-radius:5px;color:var(--t1);font-size:11px;font-family:inherit;cursor:pointer}
select:focus{outline:none;border-color:var(--g)}
.prow{display:flex;gap:5px;flex-wrap:wrap}
.pbtn{padding:5px 11px;border:1px solid var(--bdr);border-radius:5px;cursor:pointer;font-size:10px;font-family:'JetBrains Mono',monospace;font-weight:500;background:var(--bg1);color:var(--t3);transition:.12s}
.pbtn:hover{border-color:var(--bdr2)}.pbtn.on{border-color:var(--g);background:rgba(0,255,136,.07);color:var(--g)}
.runbtn{width:100%;padding:11px;background:var(--g);border:none;border-radius:7px;font-size:13px;font-weight:700;color:#000;cursor:pointer;margin-top:16px;font-family:inherit;transition:.2s}
.runbtn:hover{background:#00ff99;box-shadow:0 0 18px rgba(0,255,136,.3)}
.rpanel{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:20px;min-height:400px}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;color:var(--t4);gap:10px}
.empty .ic{font-size:42px;opacity:.3}.empty .mg{font-size:13px}
.loading{display:flex;align-items:center;justify-content:center;height:300px;flex-direction:column;gap:10px}
.spinner{width:36px;height:36px;border:3px solid var(--bdr);border-top-color:var(--g);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.sgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;margin-bottom:16px}
.scard{background:var(--bg1);border:1px solid var(--bdr);border-radius:7px;padding:12px}
.scard .sl{font-size:10px;color:var(--t4);margin-bottom:3px;letter-spacing:.5px;font-weight:600}
.scard .sv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700}
.scard .sv.pos{color:var(--g)}.scard .sv.neg{color:var(--r)}
.scard .ss{font-size:9px;color:var(--t4);margin-top:2px;font-family:'JetBrains Mono',monospace}
table.ct{width:100%;border-collapse:collapse;font-size:11px}
.ct th{text-align:left;padding:8px 10px;border-bottom:1px solid var(--bdr2);font-size:9px;letter-spacing:.5px;color:var(--t4);font-weight:700}
.ct td{padding:8px 10px;border-bottom:1px solid var(--bdr);font-family:'JetBrains Mono',monospace;font-size:11px}
.ct tr:hover td{background:var(--bg3)}
.chart-wrap{width:100%;margin-bottom:20px;position:relative}
.tm-hero{text-align:center;padding:32px 16px 24px}
.tm-hero h2{font-size:28px;font-weight:800;background:linear-gradient(135deg,var(--g),var(--c),var(--p));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
.tm-hero p{color:var(--t2);font-size:13px;max-width:460px;margin:0 auto}
.tm-ctrls{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin:20px 0}
.tm-ctrl{background:var(--bg2);border:1px solid var(--bdr);border-radius:9px;padding:14px 16px;min-width:180px}
.tm-ctrl label{font-size:10px;color:var(--t4);letter-spacing:.5px;display:block;margin-bottom:6px;font-weight:700}
.tm-ctrl select,.tm-ctrl input{width:100%;padding:9px 10px;background:var(--bg1);border:1px solid var(--bdr);border-radius:5px;color:var(--t1);font-size:13px;font-family:'JetBrains Mono',monospace;font-weight:600}
.tm-ctrl input:focus{outline:none;border-color:var(--g)}
.tm-run{padding:12px 40px;background:linear-gradient(135deg,var(--g),var(--c));border:none;border-radius:9px;font-size:14px;font-weight:700;color:#000;cursor:pointer;margin:16px auto;display:block;font-family:inherit;transition:.3s}
.tm-run:hover{transform:scale(1.04);box-shadow:0 0 24px rgba(0,255,136,.3)}
.podium{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px;max-width:860px;margin-left:auto;margin-right:auto}
.pod{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:18px;text-align:center;position:relative;overflow:hidden}
.pod.g{border-color:var(--y)}.pod.g::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--y),transparent)}
.pod.s{border-color:var(--t4)}.pod.b{border-color:var(--o)}
.pod .rk{font-size:26px;font-weight:800;margin-bottom:3px}
.pod .pa{font-size:13px;font-weight:700;margin-bottom:2px}.pod .ps{font-size:10px;color:var(--t4);margin-bottom:7px}
.pod .pv{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:700;color:var(--g)}
.pod .pr{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t2);margin-top:3px}
.helpbox{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;margin-bottom:20px;overflow:hidden}
.helpbtn{width:100%;padding:10px 16px;background:none;border:none;color:var(--t2);font-size:12px;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;transition:.15s}
.helpbtn:hover{color:var(--t1);background:var(--bg3)}
.helpbtn .arrow{transition:transform .2s;font-size:10px}
.helpbtn .arrow.open{transform:rotate(90deg)}
.helpcontent{padding:0 16px 14px;font-size:12px;color:var(--t2);line-height:1.8}
.helpcontent b{color:var(--t1);font-weight:600}
.helpcontent .hitem{margin-bottom:8px}
.helpcontent .tag{display:inline-block;background:rgba(0,255,136,.08);color:var(--g);padding:1px 6px;border-radius:4px;font-size:10px;font-weight:600;margin-right:4px;font-family:'JetBrains Mono',monospace}
.glossary{margin-top:10px;padding-top:10px;border-top:1px solid var(--bdr)}
.glossary .gi{display:flex;gap:8px;margin-bottom:6px;font-size:11px}
.glossary .gi .gt{color:var(--g);font-weight:700;min-width:44px;font-family:'JetBrains Mono',monospace;font-size:10px}
.glossary .gi .gd{color:var(--t3)}
.pfgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;max-width:1100px;margin:0 auto}
.pfcard{background:var(--bg2);border:1px solid var(--bdr);border-radius:11px;padding:20px}
.pfcard h3{font-size:15px;font-weight:700;margin-bottom:3px}.pfcard .dd{font-size:11px;color:var(--t2);margin-bottom:14px}
.abar{display:flex;height:22px;border-radius:3px;overflow:hidden;margin-bottom:10px}
.abar>div{transition:width .3s}
.alist{font-size:10px}
.aitm{display:flex;justify-content:space-between;align-items:center;padding:3px 0;border-bottom:1px solid var(--bdr)}
.aitm .dot{width:7px;height:7px;border-radius:50%;margin-right:6px;display:inline-block}
@media(max-width:900px){.sim-layout{grid-template-columns:1fr}.sidebar{position:static}.podium{grid-template-columns:1fr}.pfgrid{grid-template-columns:1fr}.hdr{padding:12px 16px}.main{padding:12px 16px}}
@media(max-width:640px){
.hdr{flex-wrap:wrap;gap:6px;padding:10px 12px}
.hdr span{font-size:13px}
.tab{font-size:11px;padding:5px 8px}
.main{padding:10px 10px}
.sgrid{grid-template-columns:1fr 1fr;gap:6px}
.agrid{grid-template-columns:1fr 1fr;gap:4px}
table.ct{font-size:9px;display:block;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch}
table.ct th,table.ct td{padding:6px 5px}
.podium{gap:8px}
.helpbtn{font-size:11px;padding:8px 12px}
.helpcontent{padding:10px 12px}
.glossary .gi .gt{min-width:36px;font-size:9px}
.glossary .gi .gd{font-size:10px}
.sbtn{padding:6px 8px}
.tm-ctrl{min-width:140px;padding:10px 12px}
.tm-ctrl select,.tm-ctrl input{font-size:12px;padding:7px 8px}
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo,useCallback,useEffect,useRef,memo}=React;

if(typeof ASSET_DATA==='undefined'){
  document.getElementById('root').innerHTML='<div style="color:#ff4466;padding:40px;text-align:center"><h2>ì˜¤ë¥˜: data.js íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2><p>data.js íŒŒì¼ì´ index.htmlê³¼ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</p></div>';
  throw new Error('ASSET_DATA not defined');
}

/* ===== ìƒìˆ˜ ===== */
const ASSETS=['SPY','QQQ','DIA','IWM','BTC_USD','ETH_USD','GLD','SLV','USO','TLT','EEM','EWY','XLE','SCHD','ARKK'];

const KR_LABELS={
  SPY:'S&P 500 (SPY)',QQQ:'ë‚˜ìŠ¤ë‹¥ 100 (QQQ)',DIA:'ë‹¤ìš°ì¡´ìŠ¤ (DIA)',IWM:'ëŸ¬ì…€ 2000 (IWM)',
  BTC_USD:'ë¹„íŠ¸ì½”ì¸ (BTC)',ETH_USD:'ì´ë”ë¦¬ì›€ (ETH)',
  GLD:'ê¸ˆ (GLD)',SLV:'ì€ (SLV)',USO:'ì›ìœ  (USO)',
  TLT:'ë¯¸êµ­ì±„ 20ë…„ (TLT)',EEM:'ì‹ í¥êµ­ (EEM)',EWY:'í•œêµ­ (EWY)',
  XLE:'ì—ë„ˆì§€ (XLE)',SCHD:'ë°°ë‹¹ ETF (SCHD)',ARKK:'ARKK í˜ì‹ '
};

const KR_CHIPS={
  SPY:'S&P 500 (SPY)',QQQ:'ë‚˜ìŠ¤ë‹¥ 100 (QQQ)',DIA:'ë‹¤ìš°ì¡´ìŠ¤ (DIA)',IWM:'ëŸ¬ì…€ 2000 (IWM)',
  BTC_USD:'ë¹„íŠ¸ì½”ì¸ (BTC)',ETH_USD:'ì´ë”ë¦¬ì›€ (ETH)',
  GLD:'ê¸ˆ (GLD)',SLV:'ì€ (SLV)',USO:'ì›ìœ  (USO)',
  TLT:'ë¯¸êµ­ì±„ 20ë…„ (TLT)',EEM:'ì‹ í¥êµ­ (EEM)',EWY:'í•œêµ­ (EWY)',
  XLE:'ì—ë„ˆì§€ (XLE)',SCHD:'ë°°ë‹¹ ETF (SCHD)',ARKK:'ARKK í˜ì‹ '
};

const KR_CATS={'ë¯¸êµ­ ì§€ìˆ˜':['SPY','QQQ','DIA','IWM'],'ì•”í˜¸í™”í':['BTC_USD','ETH_USD'],'ì›ìì¬':['GLD','SLV','USO'],'ì±„ê¶Œ':['TLT'],'í•´ì™¸':['EEM','EWY'],'ì„¹í„°/í…Œë§ˆ':['XLE','SCHD','ARKK']};

const COLORS={SPY:'#00ff88',QQQ:'#4488ff',DIA:'#ffcc00',IWM:'#ff8844',BTC_USD:'#f7931a',ETH_USD:'#627eea',GLD:'#ffd700',SLV:'#c0c0c0',USO:'#8b6914',TLT:'#00ccee',EEM:'#aa66ff',EWY:'#ff4466',XLE:'#44cc44',SCHD:'#ff66aa',ARKK:'#cc44ff'};

const EVENTS=[{d:'2001-09-11',l:'9/11'},{d:'2008-09-15',l:'2008 ê¸ˆìœµìœ„ê¸°'},{d:'2020-03-11',l:'ì½”ë¡œë‚˜ í­ë½'},{d:'2022-01-03',l:'2022 í•˜ë½ì¥'}];

const LIFE_EVENTS=[
  {l:'ëŒ€í•™ ì¡¸ì—… (2000ë…„)',y:2000},{l:'ëŒ€í•™ ì¡¸ì—… (2005ë…„)',y:2005},
  {l:'2008 ê¸ˆìœµìœ„ê¸° ì§ì „',y:2007},{l:'2008 ê¸ˆìœµìœ„ê¸° ì§í›„',y:2009},
  {l:'ì‚¬íšŒ ì´ˆë…„ìƒ (2010ë…„)',y:2010},{l:'íˆ¬ì ì‹œì‘ (2015ë…„)',y:2015},
  {l:'ì½”ë¡œë‚˜ ì§ì „ (2019ë…„)',y:2019},{l:'ì½”ë¡œë‚˜ ë½ë‹¤ìš´ (2020ë…„)',y:2020},
  {l:'ì½”ì¸ ë¶ˆì¥ (2021ë…„)',y:2021},{l:'2022 í•˜ë½ì¥ ë°”ë‹¥',y:2022}
];

function lb(ticker){return KR_LABELS[ticker]||ticker;}

/* ===== ì—”ì§„ ===== */
function calcSMA(p,n){var s=new Array(p.length).fill(null);for(var i=n-1;i<p.length;i++){var sum=0;for(var j=i-n+1;j<=i;j++)sum+=p[j];s[i]=sum/n;}return s;}
function calcRSI(p,n){var r=new Array(p.length).fill(null);if(p.length<n+1)return r;var g=0,l=0;for(var i=1;i<=n;i++){var c=p[i]-p[i-1];if(c>0)g+=c;else l-=c;}var ag=g/n,al=l/n;r[n]=al===0?100:100-100/(1+ag/al);for(var i=n+1;i<p.length;i++){var c=p[i]-p[i-1];ag=(ag*(n-1)+Math.max(c,0))/n;al=(al*(n-1)+Math.max(-c,0))/n;r[i]=al===0?100:100-100/(1+ag/al);}return r;}
function calcDD(p){var d=new Array(p.length).fill(0);var pk=p[0];for(var i=1;i<p.length;i++){if(p[i]>pk)pk=p[i];d[i]=(p[i]-pk)/pk;}return d;}
function findIdx(dates,t){for(var i=0;i<dates.length;i++){if(dates[i]>=t)return i;}return dates.length-1;}
function getStart(yrs){var d=new Date();d.setFullYear(d.getFullYear()-yrs);return d.toISOString().split('T')[0];}

function runStrategy(ticker,sType,params,startDate,endDate){
  var raw=ASSET_DATA[ticker];if(!raw)return null;
  var dates=raw.dates,prices=raw.prices;
  var si=findIdx(dates,startDate),ei=endDate?findIdx(dates,endDate):dates.length-1;
  if(si>=ei)return null;
  var budget=params.budget||500,frequency=params.frequency||'monthly',maPeriod=params.maPeriod||200,maThreshold=params.maThreshold||0,dipThreshold=params.dipThreshold||-10,rsiThreshold=params.rsiThreshold||30;
  var sma=calcSMA(prices,maPeriod),rsi=calcRSI(prices,14),dd=calcDD(prices);
  var shares=0,invested=0,lastM=-1,lastW=-1;
  var curve=[];
  var bhStart=prices[si];

  for(var i=si;i<=ei;i++){
    var date=dates[i],price=prices[i],dt=new Date(date);
    var mo=dt.getFullYear()*12+dt.getMonth(),wk=Math.floor(dt.getTime()/(7*864e5));
    var buy=false,amt=budget;

    if(sType==='dca'){
      if(frequency==='daily'){buy=true;amt=budget/21;}
      else if(frequency==='weekly'){if(wk!==lastW){buy=true;amt=budget/4.33;lastW=wk;}}
      else{if(mo!==lastM){buy=true;lastM=mo;}}
    }else if(sType==='ma'){
      if(mo!==lastM&&sma[i]!==null){lastM=mo;var pct=(price-sma[i])/sma[i]*100;if(pct<=maThreshold){buy=true;amt=budget*Math.min(3,1+Math.abs(pct-maThreshold)/10);}}
    }else if(sType==='dip'){
      if(mo!==lastM){lastM=mo;var dp=dd[i]*100,rs=rsi[i];if(dp<=dipThreshold||(rs!==null&&rs<=rsiThreshold)){buy=true;amt=budget*Math.min(3,1+Math.abs(dp)/15);}else{buy=true;amt=budget*0.3;}}
    }else if(sType==='hybrid'){
      if(mo!==lastM){lastM=mo;buy=true;amt=budget*0.5;if(sma[i]!==null&&price<sma[i])amt+=budget*0.25;if(dd[i]*100<=dipThreshold)amt+=budget*0.5;if(rsi[i]!==null&&rsi[i]<=rsiThreshold)amt+=budget*0.25;}
    }

    if(buy&&amt>0){shares+=amt/price;invested+=amt;}
    var val=shares*price;
    var bh=invested>0?(invested/bhStart)*price:0;
    curve.push({date:date,value:Math.round(val*100)/100,invested:Math.round(invested*100)/100,buyHold:Math.round(bh*100)/100});
  }

  if(curve.length===0||invested===0)return null;
  var fv=curve[curve.length-1].value;
  var yrs=(new Date(dates[ei])-new Date(dates[si]))/(365.25*864e5);
  var tr=((fv-invested)/invested)*100;
  var cagr=yrs>0?(Math.pow(fv/invested,1/yrs)-1)*100:0;
  var pk2=0,mdd=0;
  for(var j=0;j<curve.length;j++){if(curve[j].value>pk2)pk2=curve[j].value;var d2=pk2>0?(curve[j].value-pk2)/pk2:0;if(d2<mdd)mdd=d2;}
  var bhF=curve[curve.length-1].buyHold;
  var bhR=invested>0?((bhF-invested)/invested)*100:0;

  return{ticker:ticker,label:lb(ticker),curve:curve,invested:invested,finalValue:fv,totalReturn:tr,cagr:cagr,maxDD:mdd*100,avgCost:shares>0?invested/shares:0,shares:shares,bhFinal:bhF,bhReturn:bhR,years:yrs,numBuys:curve.filter(function(_,idx,a){return idx===0||a[idx].invested!==a[idx-1].invested;}).length};
}

/* ===== í¬ë§· ===== */
function fmt(n){if(Math.abs(n)>=1e6)return'$'+(n/1e6).toFixed(2)+'M';if(Math.abs(n)>=1e3)return'$'+(n/1e3).toFixed(1)+'K';return'$'+n.toFixed(2);}
function fW(n){if(Math.abs(n)>=1e8)return(n/1e8).toFixed(1)+'ì–µì›';if(Math.abs(n)>=1e4)return(n/1e4).toFixed(0)+'ë§Œì›';return n.toFixed(0)+'ì›';}
function fPct(n){return(n>=0?'+':'')+n.toFixed(2)+'%';}
function fNum(n){return n.toLocaleString(undefined,{maximumFractionDigits:2});}

/* ===== ìº”ë²„ìŠ¤ ì°¨íŠ¸ ===== */
function CanvasChart(props){
  var results=props.results,height=props.height||380,showBH=props.showBH!==false;
  var canvasRef=useRef(null);
  var wrapRef=useRef(null);
  var s1=useState(null),tip=s1[0],setTip=s1[1];

  var chartData=useMemo(function(){
    if(!results||!results.length)return null;
    var longest=results[0];
    for(var i=1;i<results.length;i++){if(results[i].curve.length>longest.curve.length)longest=results[i];}
    var raw=longest.curve;
    var step=Math.max(1,Math.floor(raw.length/600));
    var sampled=[];
    for(var i=0;i<raw.length;i++){if(i%step===0||i===raw.length-1)sampled.push(i);}
    return sampled.map(function(idx){
      var pt={date:longest.curve[idx].date};
      results.forEach(function(r){if(r.curve[idx]){pt[r.ticker]=r.curve[idx].value;pt[r.ticker+'_bh']=r.curve[idx].buyHold;}});
      return pt;
    });
  },[results]);

  useEffect(function(){
    if(!canvasRef.current||!wrapRef.current||!chartData||!chartData.length)return;
    var canvas=canvasRef.current,wrap=wrapRef.current;
    var w=wrap.clientWidth,h=height;
    var dpr=window.devicePixelRatio||1;
    canvas.width=w*dpr;canvas.height=h*dpr;
    canvas.style.width=w+'px';canvas.style.height=h+'px';
    var ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);

    var pad={t:24,r:16,b:32,l:66};
    var cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
    if(cw<40||ch<40)return;

    var yMin=Infinity,yMax=-Infinity;
    chartData.forEach(function(pt){
      results.forEach(function(r){
        if(pt[r.ticker]!==undefined){yMin=Math.min(yMin,pt[r.ticker]);yMax=Math.max(yMax,pt[r.ticker]);}
        if(showBH&&pt[r.ticker+'_bh']!==undefined){yMin=Math.min(yMin,pt[r.ticker+'_bh']);yMax=Math.max(yMax,pt[r.ticker+'_bh']);}
      });
    });
    if(yMin===yMax){yMin*=0.9;yMax*=1.1;}
    var yP=(yMax-yMin)*0.08;yMin=Math.max(0,yMin-yP);yMax+=yP;
    var xPos=function(i){return pad.l+(i/(chartData.length-1))*cw;};
    var yPos=function(v){return pad.t+ch-(v-yMin)/(yMax-yMin)*ch;};

    ctx.clearRect(0,0,w,h);

    // ê·¸ë¦¬ë“œ
    ctx.strokeStyle='#1a1a2e';ctx.lineWidth=1;
    ctx.fillStyle='#505068';ctx.font='9px JetBrains Mono,monospace';ctx.textAlign='right';
    var yStep=Math.pow(10,Math.floor(Math.log10((yMax-yMin)/4)));
    if((yMax-yMin)/yStep>8)yStep*=2;
    for(var yt=Math.ceil(yMin/yStep)*yStep;yt<=yMax;yt+=yStep){
      var yy=yPos(yt);ctx.beginPath();ctx.moveTo(pad.l,yy);ctx.lineTo(w-pad.r,yy);ctx.stroke();
      ctx.fillText(fmt(yt),pad.l-6,yy+3);
    }
    ctx.textAlign='center';
    var lStep=Math.max(1,Math.floor(chartData.length/7));
    for(var i=0;i<chartData.length;i+=lStep){
      var d=chartData[i].date;
      ctx.fillText(d.slice(0,4)+'.'+d.slice(5,7),xPos(i),h-8);
    }

    // ì´ë²¤íŠ¸ ë¼ì¸
    ctx.strokeStyle='#ff446630';ctx.setLineDash([3,3]);ctx.lineWidth=1;
    ctx.fillStyle='#ff446660';ctx.font='9px Noto Sans KR,sans-serif';ctx.textAlign='center';
    EVENTS.forEach(function(e){
      for(var i=0;i<chartData.length;i++){
        if(chartData[i].date>=e.d){
          var ex=xPos(i);ctx.beginPath();ctx.moveTo(ex,pad.t);ctx.lineTo(ex,pad.t+ch);ctx.stroke();
          ctx.fillText(e.l,ex,pad.t-6);break;
        }
      }
    });
    ctx.setLineDash([]);

    // ê±°ì¹˜ì‹ (ì ì„ )
    if(showBH){
      ctx.setLineDash([4,4]);ctx.lineWidth=1.5;ctx.strokeStyle='#8888aa';
      results.forEach(function(r){
        ctx.beginPath();var started=false;
        for(var i=0;i<chartData.length;i++){
          if(chartData[i][r.ticker+'_bh']!==undefined){
            var xx=xPos(i),yy2=yPos(chartData[i][r.ticker+'_bh']);
            if(!started){ctx.moveTo(xx,yy2);started=true;}else{ctx.lineTo(xx,yy2);}
          }
        }
        ctx.stroke();
      });
      ctx.setLineDash([]);
    }

    // ì „ëµ ë¼ì¸
    results.forEach(function(r){
      ctx.strokeStyle=COLORS[r.ticker];ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';
      ctx.beginPath();var started=false;
      for(var i=0;i<chartData.length;i++){
        if(chartData[i][r.ticker]!==undefined){
          var xx=xPos(i),yy2=yPos(chartData[i][r.ticker]);
          if(!started){ctx.moveTo(xx,yy2);started=true;}else{ctx.lineTo(xx,yy2);}
        }
      }
      ctx.stroke();
    });

    canvas._chartMeta={pad:pad,cw:cw,data:chartData,results:results};
  },[chartData,results,height,showBH]);

  var handleMouse=function(e){
    if(!canvasRef.current||!canvasRef.current._chartMeta)return;
    var rect=canvasRef.current.getBoundingClientRect();
    var mx=e.clientX-rect.left;
    var meta=canvasRef.current._chartMeta;
    var relX=mx-meta.pad.l;
    if(relX<0||relX>meta.cw){setTip(null);return;}
    var idx=Math.round((relX/meta.cw)*(meta.data.length-1));
    var pt=meta.data[Math.min(idx,meta.data.length-1)];
    if(!pt){setTip(null);return;}
    var vals=[];
    meta.results.forEach(function(r){if(pt[r.ticker]!==undefined)vals.push({ticker:r.ticker,label:lb(r.ticker),value:pt[r.ticker],color:COLORS[r.ticker]});});
    setTip({x:e.clientX-rect.left,y:e.clientY-rect.top,date:pt.date,vals:vals});
  };

  if(!results||!results.length)return null;

  return React.createElement('div',{ref:wrapRef,className:'chart-wrap',style:{height:height},onMouseMove:handleMouse,onMouseLeave:function(){setTip(null);}},
    React.createElement('canvas',{ref:canvasRef,style:{display:'block'}}),
    React.createElement('div',{style:{position:'absolute',top:4,right:8,display:'flex',gap:12,flexWrap:'wrap'}},
      results.map(function(r){return React.createElement('div',{key:r.ticker,style:{display:'flex',alignItems:'center',gap:4,fontSize:10,color:COLORS[r.ticker]}},React.createElement('div',{style:{width:10,height:3,background:COLORS[r.ticker],borderRadius:2}}),lb(r.ticker));}),
      showBH&&React.createElement('div',{style:{display:'flex',alignItems:'center',gap:4,fontSize:10,color:'#8888aa'}},React.createElement('div',{style:{width:10,height:1,background:'#8888aa'}}),'\uAC70\uCE58\uC2DD')
    ),
    tip&&React.createElement('div',{style:{position:'absolute',left:Math.min(tip.x+12,(wrapRef.current?wrapRef.current.clientWidth:800)-180),top:Math.max(tip.y-60,8),background:'#0d0d16ee',border:'1px solid #282845',borderRadius:8,padding:'8px 10px',fontSize:10,pointerEvents:'none',zIndex:10,minWidth:140}},
      React.createElement('div',{style:{color:'#9090a8',marginBottom:4,fontFamily:'JetBrains Mono,monospace'}},tip.date),
      tip.vals.map(function(v){return React.createElement('div',{key:v.ticker,style:{display:'flex',justifyContent:'space-between',gap:16,marginBottom:2}},React.createElement('span',{style:{color:v.color,fontWeight:600}},v.label),React.createElement('span',{style:{fontFamily:'JetBrains Mono,monospace',color:'#00ff88'}},fmt(v.value)));})
    )
  );
}

/* ===== í†µê³„ ì¹´ë“œ ===== */
function SC(props){
  return React.createElement('div',{className:'scard'},
    React.createElement('div',{className:'sl'},props.label),
    React.createElement('div',{className:'sv'+(props.pos===true?' pos':props.pos===false?' neg':'')},props.value),
    props.sub&&React.createElement('div',{className:'ss'},props.sub)
  );
}

/* ===== ë„ì›€ë§ ë°•ìŠ¤ ===== */
function HelpBox(props){
  var s1=useState(false),open=s1[0],setOpen=s1[1];
  return React.createElement('div',{className:'helpbox'},
    React.createElement('button',{className:'helpbtn',onClick:function(){setOpen(!open);}},
      React.createElement('span',{className:'arrow'+(open?' open':'')},'\u25B6'),
      'â„¹ï¸ ì‚¬ìš©ë²• & ìš©ì–´ ì„¤ëª…'
    ),
    open&&React.createElement('div',{className:'helpcontent'},
      props.children,
      React.createElement('div',{className:'glossary'},
        React.createElement('div',{style:{fontWeight:700,color:'var(--t1)',marginBottom:6,fontSize:11}},'ğŸ“– ì „ëµ ì„¤ëª…'),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'ì ë¦½ì‹ (ë§¤ì¼/ë§¤ì£¼/ë§¤ì›”)'),React.createElement('span',{className:'gd'},'ì •í•´ì§„ ì£¼ê¸°ë¡œ ë™ì¼ ê¸ˆì•¡ì„ ë§¤ìˆ˜í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ì „ëµ')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'ì´ë™í‰ê· ì„  (MAì¼, -N%)'),React.createElement('span',{className:'gd'},'ê°€ê²©ì´ ì´ë™í‰ê· ì„ ë³´ë‹¤ N% ì•„ë˜ì¼ ë•Œë§Œ ë§¤ìˆ˜. ì €í‰ê°€ êµ¬ê°„ì— ì§‘ì¤‘ íˆ¬ì')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'ê¸‰ë½ ë§¤ìˆ˜ (í•˜ë½ -N%, RSI N)'),React.createElement('span',{className:'gd'},'ê³ ì  ëŒ€ë¹„ N% ì´ìƒ í•˜ë½í•˜ê³  RSIê°€ ê¸°ì¤€ ì´í•˜ì¼ ë•Œ ì§‘ì¤‘ ë§¤ìˆ˜. í­ë½ì¥ì—ì„œ ê³µê²©ì  ë§¤ìˆ˜')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'í•˜ì´ë¸Œë¦¬ë“œ (MA+í•˜ë½)'),React.createElement('span',{className:'gd'},'ê¸°ë³¸ ì ë¦½ì‹ + ì´í‰ì„ /ê¸‰ë½ ì¡°ê±´ ì¶©ì¡± ì‹œ ì¶”ê°€ ë§¤ìˆ˜. ê¾¸ì¤€í•¨ê³¼ ê¸°íšŒ í¬ì°©ì„ ë™ì‹œì—')),
        React.createElement('div',{style:{fontWeight:700,color:'var(--t1)',marginTop:10,marginBottom:6,fontSize:11}},'ğŸ”¢ ìˆ«ì ì˜ë¯¸'),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'í•˜ë½ -20%'),React.createElement('span',{className:'gd'},'ìµœê·¼ ê³ ì  ëŒ€ë¹„ 20% ì´ìƒ ë–¨ì–´ì¡Œì„ ë•Œ ë§¤ìˆ˜ ì‹ í˜¸ ë°œë™')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'RSI 30'),React.createElement('span',{className:'gd'},'ê³¼ë§¤ë„ ì§€í‘œê°€ 30 ì´í•˜ì¼ ë•Œ ë§¤ìˆ˜. ìˆ«ìê°€ ë‚®ì„ìˆ˜ë¡ ë” ë–¨ì–´ì§„ ìƒíƒœ')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'MA 200ì¼'),React.createElement('span',{className:'gd'},'200ì¼ ì´ë™í‰ê· ì„  ê¸°ì¤€. ì¥ê¸° ì¶”ì„¸ íŒë‹¨ì— ì‚¬ìš©')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'-15%'),React.createElement('span',{className:'gd'},'ì´ë™í‰ê· ì„ ë³´ë‹¤ 15% ì•„ë˜ì¼ ë•Œ ë§¤ìˆ˜ ì‹ í˜¸')),
        React.createElement('div',{style:{fontWeight:700,color:'var(--t1)',marginTop:10,marginBottom:6,fontSize:11}},'ğŸ“– ìš©ì–´ ì„¤ëª…'),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'CAGR'),React.createElement('span',{className:'gd'},'ì—°í‰ê·  ë³µë¦¬ ìˆ˜ìµë¥ . ì˜ˆ: 10ë…„ê°„ +100% ìˆ˜ìµì´ë©´ CAGR â‰ˆ +7.2%')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'MDD'),React.createElement('span',{className:'gd'},'ìµœëŒ€ ë‚™í­. ê³ ì  ëŒ€ë¹„ ê°€ì¥ í¬ê²Œ ë–¨ì–´ì§„ í­. -30%ë©´ ìì‚°ì´ ìµœëŒ€ 30% ê°ì†Œí•œ ì  ìˆìŒ')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'ê±°ì¹˜ì‹'),React.createElement('span',{className:'gd'},'ì „ì²´ íˆ¬ìê¸ˆì„ ì²«ë‚  í•œ ë²ˆì— íˆ¬ì…í•˜ëŠ” ë°©ì‹. ì ë¦½ì‹ê³¼ ì„±ê³¼ë¥¼ ë¹„êµí•˜ëŠ” ê¸°ì¤€ì„ ')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'RSI'),React.createElement('span',{className:'gd'},'ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„ ì§€í‘œ. 30 ì´í•˜ = ê³¼ë§¤ë„(ë§¤ìˆ˜ ì‹ í˜¸), 70 ì´ìƒ = ê³¼ë§¤ìˆ˜')),
        React.createElement('div',{className:'gi'},React.createElement('span',{className:'gt'},'ì´í‰ì„ '),React.createElement('span',{className:'gd'},'ì´ë™í‰ê· ì„ . ì¼ì • ê¸°ê°„ ë™ì•ˆì˜ í‰ê·  ê°€ê²©. 200ì¼ì„ ì´ ëŒ€í‘œì '))
      )
    )
  );
}

/* ===== ìì‚° ì„ íƒê¸° ===== */
function AssetSel(props){
  var sel=props.sel,onChange=props.onChange,max=props.max||4;
  var toggle=function(t){if(sel.indexOf(t)>=0)onChange(sel.filter(function(x){return x!==t;}));else if(sel.length<max)onChange(sel.concat([t]));};
  var elements=[];
  Object.entries(KR_CATS).forEach(function(entry){
    var cat=entry[0],tickers=entry[1];
    elements.push(React.createElement('div',{key:'cat_'+cat,className:'catlbl'},cat));
    tickers.forEach(function(t){
      var on=sel.indexOf(t)>=0,dis=!on&&sel.length>=max;
      elements.push(React.createElement('div',{key:t,className:'achip'+(on?' on':'')+(dis?' dis':''),onClick:function(){if(!dis)toggle(t);},style:{fontSize:10,padding:'7px 4px'}},KR_CHIPS[t]));
    });
  });
  return React.createElement('div',{className:'agrid'},elements);
}

/* ===== íƒ­ 1: ì‹œë®¬ë ˆì´í„° ===== */
function Simulator(){
  var s=useState(['SPY']),assets=s[0],setA=s[1];
  var s2=useState('dca'),strat=s2[0],setS=s2[1];
  var s3=useState('monthly'),freq=s3[0],setF=s3[1];
  var s4=useState(500),budget=s4[0],setB=s4[1];
  var s5=useState(200),maP=s5[0],setMP=s5[1];
  var s6=useState(0),maT=s6[0],setMT=s6[1];
  var s7=useState(-10),dipT=s7[0],setDT=s7[1];
  var s8=useState(30),rsiT=s8[0],setRT=s8[1];
  var s9=useState(10),period=s9[0],setP=s9[1];
  var s10=useState(null),res=s10[0],setR=s10[1];
  var s11=useState(false),busy=s11[0],setBusy=s11[1];

  var run=function(){setBusy(true);setTimeout(function(){
    var sd=getStart(period);
    var r=[];assets.forEach(function(t){var result=runStrategy(t,strat,{budget:budget,frequency:freq,maPeriod:maP,maThreshold:maT,dipThreshold:dipT,rsiThreshold:rsiT},sd,null);if(result)r.push(result);});
    setR(r);setBusy(false);
  },30);};

  var sNames={dca:'ì •ì•¡ ì ë¦½ì‹ (DCA)',ma:'ì´ë™í‰ê· ì„  ì „ëµ',dip:'ê¸‰ë½ ë§¤ìˆ˜ ì „ëµ',hybrid:'í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ'};
  var stratDefs=[
    {id:'dca',l:'ì •ì•¡ ì ë¦½ì‹',d:'ì •í•´ì§„ ì£¼ê¸°ë¡œ ë™ì¼ ê¸ˆì•¡ ë§¤ìˆ˜'},
    {id:'ma',l:'ì´ë™í‰ê· ì„ ',d:'ì´í‰ì„  ì•„ë˜ì¼ ë•Œ ë§¤ìˆ˜'},
    {id:'dip',l:'ê¸‰ë½ ë§¤ìˆ˜',d:'í•˜ë½í­ & ë‚®ì€ RSIì—ì„œ ë§¤ìˆ˜'},
    {id:'hybrid',l:'í•˜ì´ë¸Œë¦¬ë“œ',d:'ì ë¦½ì‹ + ê¸‰ë½ì‹œ ì¶”ê°€ ë§¤ìˆ˜'}
  ];

  return React.createElement('div',null,
    React.createElement(HelpBox,null,
      React.createElement('div',{className:'hitem'},React.createElement('b',null,'ì‚¬ìš©ë²•: '),'ì™¼ìª½ì—ì„œ ìì‚°ê³¼ ì „ëµì„ ì„ íƒí•˜ê³ , ì„¤ì •ì„ ì¡°ì •í•œ ë’¤ ',React.createElement('span',{style:{color:'var(--g)',fontWeight:600}},'â–¶ ì‹¤í–‰'),' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”. ìµœëŒ€ 4ê°œ ìì‚°ì„ ë™ì‹œì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'),
      React.createElement('div',{style:{marginTop:8,marginBottom:4,fontWeight:600,color:'var(--t1)',fontSize:11}},'ì „ëµ ì„¤ëª…'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ì •ì•¡ ì ë¦½ì‹'),' ë§¤ì›” ë™ì¼ ê¸ˆì•¡ì„ ë§¤ìˆ˜í•©ë‹ˆë‹¤ (ì˜ˆ: ë§¤ë‹¬ $500)'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ì´ë™í‰ê· ì„ '),' ê°€ê²©ì´ ì´ë™í‰ê· ì„  ì•„ë˜ì¼ ë•Œë§Œ ë§¤ìˆ˜í•©ë‹ˆë‹¤. ì €í‰ê°€ êµ¬ê°„ì—ì„œ ì§‘ì¤‘ ë§¤ìˆ˜í•˜ëŠ” ì „ëµ'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ê¸‰ë½ ë§¤ìˆ˜'),' ê³ ì  ëŒ€ë¹„ ì¼ì •% í•˜ë½í•˜ê±°ë‚˜ RSIê°€ ë‚®ì„ ë•Œ ì§‘ì¤‘ ë§¤ìˆ˜. í‰ì†Œì—” ì†ŒëŸ‰ë§Œ ë§¤ìˆ˜'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'í•˜ì´ë¸Œë¦¬ë“œ'),' ê¸°ë³¸ ì ë¦½ì‹ + ê¸‰ë½/ì´í‰ì„  ì´íƒˆ ì‹œ ì¶”ê°€ ë§¤ìˆ˜. ê¾¸ì¤€í•¨ê³¼ ê¸°íšŒ í¬ì°©ì„ ë™ì‹œì—'),
      React.createElement('div',{className:'hitem',style:{marginTop:8}},'ğŸ“ˆ ì°¨íŠ¸ì˜ ',React.createElement('span',{style:{color:'#8888aa',fontWeight:600}},'ì ì„ '),'ì€ ê±°ì¹˜ì‹(ê°™ì€ ê¸ˆì•¡ì„ ì²«ë‚  ì¼ì‹œë¶ˆ íˆ¬ì) ëŒ€ë¹„ ì„±ê³¼ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.')
    ),
    React.createElement('div',{className:'sim-layout'},
    React.createElement('div',{className:'sidebar'},
      React.createElement('div',{className:'stitle'},'ìì‚° ì„ íƒ (ìµœëŒ€ 4ê°œ)'),
      React.createElement(AssetSel,{sel:assets,onChange:setA,max:4}),
      React.createElement('div',{className:'stitle'},'ì „ëµ'),
      stratDefs.map(function(s){return React.createElement('div',{key:s.id,className:'sbtn'+(strat===s.id?' on':''),onClick:function(){setS(s.id);}},React.createElement('span',{className:'lb'},s.l),React.createElement('span',{className:'ds'},s.d));}),
      React.createElement('div',{className:'stitle'},'ì„¤ì •'),
      React.createElement('div',{className:'sgrp'},
        React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'ì›” íˆ¬ìê¸ˆ'),React.createElement('span',{className:'sval'},'$'+budget)),
        React.createElement('input',{type:'range',min:100,max:5000,step:100,value:budget,onChange:function(e){setB(+e.target.value);}})
      ),
      strat==='dca'&&React.createElement('div',{className:'sgrp'},
        React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'ë§¤ìˆ˜ ì£¼ê¸°')),
        React.createElement('select',{value:freq,onChange:function(e){setF(e.target.value);}},
          React.createElement('option',{value:'daily'},'ë§¤ì¼'),
          React.createElement('option',{value:'weekly'},'ë§¤ì£¼'),
          React.createElement('option',{value:'monthly'},'ë§¤ì›”')
        )
      ),
      (strat==='ma'||strat==='hybrid')&&React.createElement(React.Fragment,null,
        React.createElement('div',{className:'sgrp'},
          React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'ì´í‰ì„  ê¸°ê°„'),React.createElement('span',{className:'sval'},maP+'ì¼')),
          React.createElement('input',{type:'range',min:10,max:300,step:10,value:maP,onChange:function(e){setMP(+e.target.value);}})
        ),
        strat==='ma'&&React.createElement('div',{className:'sgrp'},
          React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'MA í•˜ë°© ë§¤ìˆ˜ ê¸°ì¤€'),React.createElement('span',{className:'sval'},maT+'%')),
          React.createElement('input',{type:'range',min:-20,max:5,step:1,value:maT,onChange:function(e){setMT(+e.target.value);}})
        )
      ),
      (strat==='dip'||strat==='hybrid')&&React.createElement(React.Fragment,null,
        React.createElement('div',{className:'sgrp'},
          React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'í•˜ë½í­ ê¸°ì¤€'),React.createElement('span',{className:'sval'},dipT+'%')),
          React.createElement('input',{type:'range',min:-40,max:-3,step:1,value:dipT,onChange:function(e){setDT(+e.target.value);}})
        ),
        React.createElement('div',{className:'sgrp'},
          React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},'RSI ê¸°ì¤€'),React.createElement('span',{className:'sval'},rsiT)),
          React.createElement('input',{type:'range',min:15,max:50,step:1,value:rsiT,onChange:function(e){setRT(+e.target.value);}})
        )
      ),
      React.createElement('div',{className:'stitle'},'íˆ¬ì ê¸°ê°„'),
      React.createElement('div',{className:'prow'},[25,20,15,10,5,3].map(function(y){return React.createElement('div',{key:y,className:'pbtn'+(period===y?' on':''),onClick:function(){setP(y);}},y+'ë…„');})),
      React.createElement('button',{className:'runbtn',onClick:run},'â–¶ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰')
    ),
    React.createElement('div',{className:'rpanel'},
      busy?React.createElement('div',{className:'loading'},React.createElement('div',{className:'spinner'}),React.createElement('span',{style:{color:'var(--t4)',fontSize:12}},'ê³„ì‚° ì¤‘...')):
      !res?React.createElement('div',{className:'empty'},React.createElement('div',{className:'ic'},'ğŸ“Š'),React.createElement('span',{className:'mg'},'ìì‚°ê³¼ ì „ëµì„ ì„ íƒí•œ í›„ ì‹¤í–‰ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”')):
      React.createElement(React.Fragment,null,
        React.createElement('div',{style:{fontSize:15,fontWeight:600,marginBottom:16}},sNames[strat]+' â€” '+period+'ë…„ ë°±í…ŒìŠ¤íŠ¸'),
        React.createElement(CanvasChart,{results:res,showBH:true}),
        res.map(function(r){
          return React.createElement('div',{key:r.ticker,style:{marginBottom:20}},
            React.createElement('div',{style:{display:'flex',alignItems:'center',gap:7,marginBottom:10}},
              React.createElement('div',{style:{width:10,height:10,borderRadius:3,background:COLORS[r.ticker]}}),
              React.createElement('span',{style:{fontWeight:700,fontSize:14}},r.label),
              React.createElement('span',{style:{color:'var(--t4)',fontSize:11,fontFamily:'JetBrains Mono'}},r.ticker)
            ),
            React.createElement('div',{className:'sgrid'},
              React.createElement(SC,{label:'ìµœì¢… ìì‚°',value:fmt(r.finalValue),sub:'íˆ¬ì ì›ê¸ˆ: '+fmt(r.invested),pos:r.finalValue>r.invested}),
              React.createElement(SC,{label:'ì´ ìˆ˜ìµë¥ ',value:fPct(r.totalReturn),sub:'ê±°ì¹˜ì‹: '+fPct(r.bhReturn),pos:r.totalReturn>0}),
              React.createElement(SC,{label:'ì—°í‰ê·  ìˆ˜ìµë¥  (CAGR)',value:fPct(r.cagr),pos:r.cagr>0}),
              React.createElement(SC,{label:'ìµœëŒ€ ë‚™í­ (MDD)',value:fPct(r.maxDD),pos:false}),
              React.createElement(SC,{label:'í‰ê·  ë§¤ìˆ˜ê°€',value:'$'+fNum(r.avgCost),sub:fNum(r.shares)+' ì£¼'}),
              React.createElement(SC,{label:'íˆ¬ì ê¸°ê°„',value:r.years.toFixed(1)+'ë…„'})
            )
          );
        }),
        res.length>1&&React.createElement(React.Fragment,null,
          React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:10}},'ìì‚° ë¹„êµ'),
          React.createElement('table',{className:'ct'},
            React.createElement('thead',null,React.createElement('tr',null,
              React.createElement('th',null,'ìì‚°'),React.createElement('th',null,'ìµœì¢… ìì‚°'),React.createElement('th',null,'ìˆ˜ìµë¥ '),React.createElement('th',null,'CAGR'),React.createElement('th',null,'MDD'),React.createElement('th',null,'vs ê±°ì¹˜ì‹')
            )),
            React.createElement('tbody',null,
              res.slice().sort(function(a,b){return b.finalValue-a.finalValue;}).map(function(r){
                return React.createElement('tr',{key:r.ticker},
                  React.createElement('td',{style:{color:COLORS[r.ticker],fontWeight:600}},r.label),
                  React.createElement('td',{style:{color:'var(--g)'}},fmt(r.finalValue)),
                  React.createElement('td',{style:{color:r.totalReturn>0?'var(--g)':'var(--r)'}},fPct(r.totalReturn)),
                  React.createElement('td',null,fPct(r.cagr)),
                  React.createElement('td',{style:{color:'var(--r)'}},fPct(r.maxDD)),
                  React.createElement('td',{style:{color:r.totalReturn>r.bhReturn?'var(--g)':'var(--r)'}},(r.totalReturn>r.bhReturn?'â–² ':'â–¼ ')+Math.abs(r.totalReturn-r.bhReturn).toFixed(1)+'%')
                );
              })
            )
          )
        )
      )
    )
    )
  );
}

/* ===== íƒ­ 2: íƒ€ì„ë¨¸ì‹  ===== */
function TimeMachine(){
  var s1=useState(0),evt=s1[0],setE=s1[1];
  var s2=useState(''),cYear=s2[0],setCY=s2[1];
  var s3=useState(500),budget=s3[0],setB=s3[1];
  var s4=useState(null),res=s4[0],setR=s4[1];
  var s5=useState(false),busy=s5[0],setBusy=s5[1];

  var run=function(){setBusy(true);setTimeout(function(){
    var yr=cYear?parseInt(cYear):LIFE_EVENTS[evt].y;
    var sd=yr+'-01-01';
    var strats=[
      {t:'dca',l:'ì›” ì ë¦½ì‹',p:{budget:budget,frequency:'monthly'}},
      {t:'dca',l:'ì£¼ ì ë¦½ì‹',p:{budget:budget,frequency:'weekly'}},
      {t:'ma',l:'MA200 ì „ëµ',p:{budget:budget,maPeriod:200,maThreshold:0}},
      {t:'ma',l:'MA50 ê³µê²©í˜•',p:{budget:budget,maPeriod:50,maThreshold:-5}},
      {t:'dip',l:'ê¸‰ë½ -10%',p:{budget:budget,dipThreshold:-10,rsiThreshold:30}},
      {t:'dip',l:'ê¸‰ë½ -20%',p:{budget:budget,dipThreshold:-20,rsiThreshold:25}},
      {t:'hybrid',l:'í•˜ì´ë¸Œë¦¬ë“œ',p:{budget:budget,maPeriod:200,dipThreshold:-10,rsiThreshold:30}}
    ];
    var all=[];
    ASSETS.forEach(function(tk){strats.forEach(function(s){var r=runStrategy(tk,s.t,s.p,sd,null);if(r){r.stratLabel=s.l;all.push(r);}});});
    all.sort(function(a,b){return b.finalValue-a.finalValue;});
    setR({all:all,yr:yr,budget:budget});setBusy(false);
  },80);};

  return React.createElement('div',null,
    React.createElement(HelpBox,null,
      React.createElement('div',{className:'hitem'},React.createElement('b',null,'ì‚¬ìš©ë²•: '),'ì‹œì‘ ì‹œì ê³¼ ì›” íˆ¬ìê¸ˆì„ ì„ íƒí•œ ë’¤ ',React.createElement('span',{style:{color:'var(--g)',fontWeight:600}},'ğŸš€ ì „ì²´ ì „ëµ ê³„ì‚°'),' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.'),
      React.createElement('div',{className:'hitem'},'15ê°œ ìì‚° Ã— 7ê°œ ì „ëµ = ',React.createElement('b',null,'105ê°œ ì¡°í•©'),'ì„ ìë™ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ìˆ˜ìµë¥  ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.'),
      React.createElement('div',{className:'hitem'},'ê³¼ê±° ì‹œì ë¶€í„° ë§¤ì›” ê¾¸ì¤€íˆ íˆ¬ìí–ˆë‹¤ë©´ ì˜¤ëŠ˜ ìì‚°ì´ ì–¼ë§ˆê°€ ëì„ì§€ í™•ì¸í•´ë³´ì„¸ìš”.')
    ),
    React.createElement('div',{className:'tm-hero'},
      React.createElement('h2',null,'â° íƒ€ì„ë¨¸ì‹ '),
      React.createElement('p',null,'ê³¼ê±°ì˜ í•œ ì‹œì ì„ ì„ íƒí•˜ì„¸ìš”. ëª¨ë“  ì „ëµì˜ í˜„ì¬ ê°€ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.')
    ),
    React.createElement('div',{className:'tm-ctrls'},
      React.createElement('div',{className:'tm-ctrl'},
        React.createElement('label',null,'ì‹œì‘ ì‹œì '),
        React.createElement('select',{value:evt,onChange:function(e){setE(+e.target.value);setCY('');}},LIFE_EVENTS.map(function(e,i){return React.createElement('option',{key:i,value:i},e.l);}))
      ),
      React.createElement('div',{className:'tm-ctrl'},
        React.createElement('label',null,'ì§ì ‘ ì…ë ¥ (ì—°ë„)'),
        React.createElement('input',{type:'number',min:1998,max:2025,placeholder:'ì˜ˆ: 2015',value:cYear,onChange:function(e){setCY(e.target.value);}})
      ),
      React.createElement('div',{className:'tm-ctrl'},
        React.createElement('label',null,'ì›” íˆ¬ìê¸ˆ'),
        React.createElement('select',{value:budget,onChange:function(e){setB(+e.target.value);}},[100,200,300,500,1000,2000,5000].map(function(b){return React.createElement('option',{key:b,value:b},'$'+b+'/ì›”');}))
      )
    ),
    React.createElement('button',{className:'tm-run',onClick:run},'ğŸš€ ì „ì²´ ì „ëµ ê³„ì‚°'),
    busy&&React.createElement('div',{className:'loading'},React.createElement('div',{className:'spinner'}),React.createElement('span',{style:{color:'var(--t4)',fontSize:12}},ASSETS.length*7+'ê°œ ì¡°í•© í…ŒìŠ¤íŠ¸ ì¤‘...')),
    res&&!busy&&React.createElement('div',{style:{marginTop:20}},
      React.createElement('div',{style:{textAlign:'center',color:'var(--t2)',fontSize:12,marginBottom:16}},
        React.createElement('span',{style:{color:'var(--g)',fontWeight:700}},res.yr+'ë…„'),' ë¶€í„° ',
        React.createElement('span',{style:{color:'var(--g)',fontWeight:700}},'$'+res.budget+'/ì›”'),' íˆ¬ì â€” ',res.all.length+'ê°œ ì¡°í•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ'
      ),
      React.createElement('div',{className:'podium'},
        res.all.slice(0,3).map(function(r,i){
          var cls=['g','s','b'][i];
          return React.createElement('div',{key:i,className:'pod '+cls},
            React.createElement('div',{className:'rk'},['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]),
            React.createElement('div',{className:'pa'},r.label),
            React.createElement('div',{className:'ps'},r.stratLabel),
            React.createElement('div',{className:'pv'},fmt(r.finalValue)),
            React.createElement('div',{className:'pr'},fPct(r.totalReturn)+' Â· ì›ê¸ˆ '+fmt(r.invested))
          );
        })
      ),
      React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16,marginBottom:16}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:10}},'ìƒìœ„ 3ê°œ ìì‚° ê³¡ì„ '),
        React.createElement(CanvasChart,{results:res.all.slice(0,3),showBH:false})
      ),
      React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16,maxHeight:480,overflowY:'auto'}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:10}},'ì „ì²´ ê²°ê³¼ (ìƒìœ„ 50ê°œ)'),
        React.createElement('table',{className:'ct'},
          React.createElement('thead',null,React.createElement('tr',null,
            React.createElement('th',null,'ìˆœìœ„'),React.createElement('th',null,'ìì‚°'),React.createElement('th',null,'ì „ëµ'),React.createElement('th',null,'ìµœì¢… ìì‚°'),React.createElement('th',null,'ì›ê¸ˆ'),React.createElement('th',null,'ìˆ˜ìµë¥ '),React.createElement('th',null,'CAGR'),React.createElement('th',null,'MDD')
          )),
          React.createElement('tbody',null,
            res.all.slice(0,50).map(function(r,i){
              return React.createElement('tr',{key:i},
                React.createElement('td',{style:{color:i<3?'var(--y)':'var(--t4)'}},i+1),
                React.createElement('td',{style:{color:COLORS[r.ticker],fontWeight:600}},r.label),
                React.createElement('td',null,r.stratLabel),
                React.createElement('td',{style:{color:'var(--g)',fontWeight:600}},fmt(r.finalValue)),
                React.createElement('td',{style:{color:'var(--t2)'}},fmt(r.invested)),
                React.createElement('td',{style:{color:r.totalReturn>0?'var(--g)':'var(--r)'}},fPct(r.totalReturn)),
                React.createElement('td',null,fPct(r.cagr)),
                React.createElement('td',{style:{color:'var(--r)'}},fPct(r.maxDD))
              );
            })
          )
        )
      )
    )
  );
}

/* ===== íƒ­ 3: ìµœì  í¬íŠ¸í´ë¦¬ì˜¤ ===== */
function ComparisonChart(props){
  var portfolios=props.portfolios,height=props.height||340;
  var canRef=useRef(null),wRef=useRef(null);
  var s1=useState(null),tip=s1[0],setTip=s1[1];
  useEffect(function(){
    if(!canRef.current||!wRef.current||!portfolios||!portfolios.length)return;
    var c=canRef.current,wrap=wRef.current;
    var w=wrap.clientWidth,h=height;
    var dpr=window.devicePixelRatio||1;
    c.width=w*dpr;c.height=h*dpr;c.style.width=w+'px';c.style.height=h+'px';
    var ctx=c.getContext('2d');ctx.scale(dpr,dpr);
    var pad={t:16,r:16,b:30,l:66};
    var cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
    if(cw<40||ch<40)return;
    // Y range across all portfolios
    var yMin=Infinity,yMax=-Infinity;
    portfolios.forEach(function(p){p.pfCurve.forEach(function(v){if(v<yMin)yMin=v;if(v>yMax)yMax=v;});});
    if(yMin===yMax){yMin*=0.9;yMax*=1.1;}
    var yP2=(yMax-yMin)*0.08;yMin=Math.max(0,yMin-yP2);yMax+=yP2;
    var maxLen=0;portfolios.forEach(function(p){if(p.pfCurve.length>maxLen)maxLen=p.pfCurve.length;});
    var xPos=function(i,len){return pad.l+(i/(len-1))*cw;};
    var yPos=function(v){return pad.t+ch-(v-yMin)/(yMax-yMin)*ch;};

    ctx.clearRect(0,0,w,h);
    // Grid
    ctx.strokeStyle='#1a1a2e';ctx.lineWidth=1;ctx.fillStyle='#686880';ctx.font='9px JetBrains Mono,monospace';ctx.textAlign='right';
    var yStep=Math.pow(10,Math.floor(Math.log10((yMax-yMin)/4)));
    if((yMax-yMin)/yStep>8)yStep*=2;
    for(var yt=Math.ceil(yMin/yStep)*yStep;yt<=yMax;yt+=yStep){
      var yy=yPos(yt);ctx.beginPath();ctx.moveTo(pad.l,yy);ctx.lineTo(w-pad.r,yy);ctx.stroke();
      ctx.fillText(fmt(yt),pad.l-6,yy+3);
    }
    // X labels - use dates from longest portfolio
    var longest=portfolios[0];portfolios.forEach(function(p){if(p.pfDates.length>longest.pfDates.length)longest=p;});
    ctx.textAlign='center';
    var step=Math.max(1,Math.floor(longest.pfCurve.length/300));
    var lStep2=Math.max(1,Math.floor(longest.pfDates.length/7));
    for(var i=0;i<longest.pfDates.length;i+=lStep2){
      var d=longest.pfDates[i];
      if(d)ctx.fillText(d.slice(0,4)+'.'+d.slice(5,7),xPos(i,longest.pfDates.length),h-8);
    }
    // Draw each portfolio
    portfolios.forEach(function(p){
      var pts=p.pfCurve;var s2=Math.max(1,Math.floor(pts.length/300));
      // Area
      ctx.beginPath();ctx.moveTo(xPos(0,pts.length),h-pad.b);
      for(var i=0;i<pts.length;i+=s2){ctx.lineTo(xPos(i,pts.length),yPos(pts[i]));}
      ctx.lineTo(xPos(pts.length-1,pts.length),yPos(pts[pts.length-1]));
      ctx.lineTo(xPos(pts.length-1,pts.length),h-pad.b);ctx.closePath();
      var grad=ctx.createLinearGradient(0,0,0,h);
      grad.addColorStop(0,p.pfColor+'18');grad.addColorStop(1,p.pfColor+'03');
      ctx.fillStyle=grad;ctx.fill();
      // Line
      ctx.beginPath();ctx.strokeStyle=p.pfColor;ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';
      var started=false;
      for(var i=0;i<pts.length;i+=s2){
        var xx=xPos(i,pts.length),yy2=yPos(pts[i]);
        if(!started){ctx.moveTo(xx,yy2);started=true;}else ctx.lineTo(xx,yy2);
      }
      // Make sure last point is included
      ctx.lineTo(xPos(pts.length-1,pts.length),yPos(pts[pts.length-1]));
      ctx.stroke();
    });
    c._meta={pad:pad,cw:cw,portfolios:portfolios};
  },[portfolios,height]);

  var handleMouse=function(e){
    if(!canRef.current||!canRef.current._meta)return;
    var rect=canRef.current.getBoundingClientRect();
    var mx=e.clientX-rect.left;
    var meta=canRef.current._meta;
    var relX=mx-meta.pad.l;
    if(relX<0||relX>meta.cw){setTip(null);return;}
    var pct=relX/meta.cw;
    var vals=meta.portfolios.map(function(p){
      var idx=Math.round(pct*(p.pfCurve.length-1));
      idx=Math.min(idx,p.pfCurve.length-1);
      return{name:p.name.replace(/[^\w\sã„±-í£]/g,'').trim(),value:p.pfCurve[idx],color:p.pfColor,date:p.pfDates[idx]};
    });
    setTip({x:e.clientX-rect.left,y:e.clientY-rect.top,vals:vals});
  };

  return React.createElement('div',{ref:wRef,style:{width:'100%',height:height,position:'relative'},onMouseMove:handleMouse,onMouseLeave:function(){setTip(null);}},
    React.createElement('canvas',{ref:canRef,style:{display:'block'}}),
    tip&&React.createElement('div',{style:{position:'absolute',left:Math.min(tip.x+12,(wRef.current?wRef.current.clientWidth:800)-200),top:Math.max(tip.y-80,8),background:'#0d0d16ee',border:'1px solid #282845',borderRadius:8,padding:'8px 10px',fontSize:10,pointerEvents:'none',zIndex:10,minWidth:160}},
      tip.vals[0]&&tip.vals[0].date&&React.createElement('div',{style:{color:'#9090a8',marginBottom:4,fontFamily:'JetBrains Mono,monospace'}},tip.vals[0].date),
      tip.vals.map(function(v,i){return React.createElement('div',{key:i,style:{display:'flex',justifyContent:'space-between',gap:16,marginBottom:2}},React.createElement('span',{style:{color:v.color,fontWeight:600}},v.name),React.createElement('span',{style:{fontFamily:'JetBrains Mono,monospace',color:'var(--g)'}},fmt(v.value)));})
    )
  );
}

function Sparkline(props){
  var data=props.data,color=props.color||'#00ff88',h=props.height||100;
  var canRef=useRef(null),wRef=useRef(null);
  useEffect(function(){
    if(!canRef.current||!wRef.current||!data||!data.length)return;
    var c=canRef.current,w=wRef.current.clientWidth;
    var dpr=window.devicePixelRatio||1;
    c.width=w*dpr;c.height=h*dpr;c.style.width=w+'px';c.style.height=h+'px';
    var ctx=c.getContext('2d');ctx.scale(dpr,dpr);
    var pad=4,cw=w-pad*2,ch=h-pad*2;
    var mn=Infinity,mx=-Infinity;
    data.forEach(function(v){if(v<mn)mn=v;if(v>mx)mx=v;});
    if(mn===mx){mn*=0.9;mx*=1.1;}
    var step=Math.max(1,Math.floor(data.length/300));
    var pts=[];for(var i=0;i<data.length;i+=step)pts.push(data[i]);if(pts[pts.length-1]!==data[data.length-1])pts.push(data[data.length-1]);
    // Area fill
    ctx.beginPath();
    ctx.moveTo(pad,h-pad);
    pts.forEach(function(v,i){var x=pad+(i/(pts.length-1))*cw;var y=pad+ch-(v-mn)/(mx-mn)*ch;if(i===0)ctx.lineTo(x,y);else ctx.lineTo(x,y);});
    ctx.lineTo(pad+cw,h-pad);ctx.closePath();
    var grad=ctx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,color+'40');grad.addColorStop(1,color+'05');
    ctx.fillStyle=grad;ctx.fill();
    // Line
    ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=2;ctx.lineJoin='round';
    pts.forEach(function(v,i){var x=pad+(i/(pts.length-1))*cw;var y=pad+ch-(v-mn)/(mx-mn)*ch;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);});
    ctx.stroke();
  },[data,color,h]);
  if(!data||!data.length)return null;
  return React.createElement('div',{ref:wRef,style:{width:'100%',height:h,marginBottom:8}},React.createElement('canvas',{ref:canRef,style:{display:'block'}}));
}

function BestPortfolios(){
  var s1=useState(10),period=s1[0],setP=s1[1];
  var s2=useState(null),res=s2[0],setR=s2[1];
  var s3=useState(false),busy=s3[0],setBusy=s3[1];
  var PC=['#00ff88','#4488ff','#ffcc00','#ff8844','#f7931a','#627eea','#ffd700','#00ccee','#aa66ff','#ff4466','#44cc44','#ff66aa','#cc44ff','#c0c0c0','#8b6914'];
  var PF_COLORS=['#00ff88','#4488ff','#ffcc00'];

  var run=function(){setBusy(true);setTimeout(function(){
    var sd=getStart(period);
    var ar={};ASSETS.forEach(function(t){var r=runStrategy(t,'dca',{budget:500,frequency:'monthly'},sd,null);if(r)ar[t]=r;});
    var av=Object.keys(ar);if(!av.length){setR(null);setBusy(false);return;}
    var byR=av.slice().sort(function(a,b){return ar[b].totalReturn-ar[a].totalReturn;});
    var byDD=av.slice().sort(function(a,b){return ar[b].maxDD-ar[a].maxDD;});
    var byS=av.slice().sort(function(a,b){var sa=ar[a].maxDD!==0?ar[a].cagr/Math.abs(ar[a].maxDD):0;var sb=ar[b].maxDD!==0?ar[b].cagr/Math.abs(ar[b].maxDD):0;return sb-sa;});

    var build=function(ranked,name,desc,pfColor){
      var top=ranked.slice(0,5),ws=[20,20,20,20,20];
      var allocs=top.map(function(t,i){var o=Object.assign({},ar[t]);o.w=ws[i];o.color=PC[ASSETS.indexOf(t)];return o;});
      var wr=allocs.reduce(function(s,a){return s+a.totalReturn*a.w/100;},0);
      var wc=allocs.reduce(function(s,a){return s+a.cagr*a.w/100;},0);
      // Build weighted portfolio curve
      var minLen=Infinity;
      allocs.forEach(function(a){if(a.curve&&a.curve.length<minLen)minLen=a.curve.length;});
      var pfCurve=[],pfDates=[];
      if(minLen>0&&minLen<Infinity){
        for(var i=0;i<minLen;i++){
          var wVal=0;
          allocs.forEach(function(a){if(a.curve&&a.curve[i])wVal+=a.curve[i].value*(a.w/100);});
          pfCurve.push(Math.round(wVal*100)/100);
          if(allocs[0].curve[i])pfDates.push(allocs[0].curve[i].date);
        }
      }
      return{name:name,desc:desc,allocs:allocs,wr:wr,wc:wc,pfCurve:pfCurve,pfDates:pfDates,pfColor:pfColor};
    };

    setR({
      maxR:build(byR,'ğŸš€ ìµœëŒ€ ìˆ˜ìµ','ì´ ìˆ˜ìµë¥  ìµœëŒ€í™” ê¸°ì¤€',PF_COLORS[0]),
      bestS:build(byS,'âš–ï¸ ìµœê³  ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ','ë‚™í­ ëŒ€ë¹„ ìˆ˜ìµë¥  ìµœì í™”',PF_COLORS[1]),
      lowDD:build(byDD,'ğŸ›¡ï¸ ìµœì†Œ ë‚™í­','í¬íŠ¸í´ë¦¬ì˜¤ í•˜ë½ ìµœì†Œí™”',PF_COLORS[2]),
      ind:av.map(function(t){return ar[t];}).sort(function(a,b){return b.totalReturn-a.totalReturn;})
    });
    setBusy(false);
  },80);};

  useEffect(run,[period]);

  return React.createElement('div',null,
    React.createElement(HelpBox,null,
      React.createElement('div',{className:'hitem'},React.createElement('b',null,'ì‚¬ìš©ë²•: '),'ê¸°ê°„ì„ ì„ íƒí•˜ë©´ ë§¤ë‹¬ $500 ë¬´ì§€ì„± ì ë¦½ì‹ ê¸°ì¤€ìœ¼ë¡œ ìµœì  í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìë™ ê³„ì‚°í•©ë‹ˆë‹¤.'),
      React.createElement('div',{className:'hitem'},'ì „ëµ? íƒ€ì´ë°? ê·¸ëŸ° ê±° ì—†ìŠµë‹ˆë‹¤. ë§¤ë‹¬ ê°™ì€ ê¸ˆì•¡ì„ ë„£ê¸°ë§Œ í–ˆì„ ë•Œ ì–´ë–¤ ìì‚° ì¡°í•©ì´ ìµœê³ ì˜€ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ìµœëŒ€ ìˆ˜ìµ'),' ì´ ìˆ˜ìµë¥ ì´ ê°€ì¥ ë†’ì€ ìì‚° ì¡°í•©'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ'),' ë‚™í­ ëŒ€ë¹„ ìˆ˜ìµë¥ ì´ ê°€ì¥ ì¢‹ì€ ìì‚° ì¡°í•© (ë¦¬ìŠ¤í¬ íš¨ìœ¨)'),
      React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'ìµœì†Œ ë‚™í­'),' í•˜ë½ì¥ì—ì„œ ê°€ì¥ ì ê²Œ ë–¨ì–´ì§€ëŠ” ì•ˆì •ì ì¸ ìì‚° ì¡°í•©'),
      React.createElement('div',{className:'hitem',style:{marginTop:6}},'ìƒìœ„ 5ê°œ ìì‚°ì— ê° 20%ì”© ê· ë“± ë°°ë¶„í•©ë‹ˆë‹¤.')
    ),
    React.createElement('div',{style:{textAlign:'center',padding:'28px 0 18px'}},
      React.createElement('h2',{style:{fontSize:26,fontWeight:800,marginBottom:8}},'ğŸ¤· ë¬´ì§€ì„± ì ë¦½ì‹ ìµœê°• ì¡°í•©'),
      React.createElement('p',{style:{fontSize:14,marginBottom:16,lineHeight:1.7}},
        'ë§¤ë‹¬ ',React.createElement('span',{style:{color:'#00ff88',fontWeight:800,fontSize:16}},'$500'),', ì•„ë¬´ ìƒê° ì—†ì´ ',React.createElement('span',{style:{color:'#ffcc00',fontWeight:700}},'ê¾¸ì¤€íˆ ë„£ê¸°ë§Œ'),' í–ˆë‹¤ë©´',React.createElement('br',null),'ì–´ë–¤ ìì‚°ì´ ',React.createElement('span',{style:{color:'#4488ff',fontWeight:700}},'ìµœê³ '),'ì˜€ì„ê¹Œ?'
      ),
      React.createElement('div',{className:'prow',style:{justifyContent:'center'}},[25,20,15,10,5,3,1].map(function(y){return React.createElement('div',{key:y,className:'pbtn'+(period===y?' on':''),onClick:function(){setP(y);}},y+'ë…„');}))
    ),
    busy?React.createElement('div',{className:'loading'},React.createElement('div',{className:'spinner'})):
    res&&React.createElement(React.Fragment,null,
      React.createElement('div',{className:'pfgrid'},
        [res.maxR,res.bestS,res.lowDD].map(function(p,pi){
          return React.createElement('div',{key:pi,className:'pfcard'},
            React.createElement('h3',null,p.name),
            React.createElement('div',{className:'dd'},p.desc),
            React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:18,fontWeight:700,color:'var(--g)',marginBottom:3}},fPct(p.wr)+' ìˆ˜ìµ'),
            React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:11,color:'var(--t2)',marginBottom:10}},'CAGR: '+fPct(p.wc)),
            React.createElement(Sparkline,{data:p.pfCurve,color:p.pfColor,height:100}),
            React.createElement('div',{className:'abar'},p.allocs.map(function(a,i){return React.createElement('div',{key:i,style:{width:a.w+'%',background:a.color},title:a.label+': '+a.w+'%'});})),
            React.createElement('div',{className:'alist'},p.allocs.map(function(a,i){
              return React.createElement('div',{key:i,className:'aitm'},
                React.createElement('span',null,React.createElement('span',{className:'dot',style:{background:a.color}}),a.label),
                React.createElement('span',{style:{fontFamily:'JetBrains Mono',fontWeight:600}},a.w+'% Â· '+fPct(a.totalReturn))
              );
            }))
          );
        })
      ),
      // Big comparison chart
      React.createElement('div',{style:{marginTop:20,background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:20}},
        React.createElement('div',{style:{fontSize:14,fontWeight:700,marginBottom:4}},'í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼ ë¹„êµ'),
        React.createElement('div',{style:{fontSize:11,color:'var(--t2)',marginBottom:14}},period+'ë…„ê°„ $500/ì›” ì ë¦½ ì‹œ í¬íŠ¸í´ë¦¬ì˜¤ ìì‚° ë³€í™”'),
        React.createElement('div',{style:{display:'flex',gap:16,marginBottom:10,flexWrap:'wrap'}},
          [res.maxR,res.bestS,res.lowDD].map(function(p,i){
            return React.createElement('div',{key:i,style:{display:'flex',alignItems:'center',gap:5,fontSize:11}},
              React.createElement('div',{style:{width:12,height:3,borderRadius:2,background:p.pfColor}}),
              React.createElement('span',{style:{color:p.pfColor,fontWeight:600}},p.name.replace(/[^\w\sã„±-í£]/g,'').trim())
            );
          })
        ),
        React.createElement(ComparisonChart,{portfolios:[res.maxR,res.bestS,res.lowDD],height:340})
      ),
      // Individual rankings table
      React.createElement('div',{style:{marginTop:20,background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:10}},'ê°œë³„ ìì‚° ìˆœìœ„ ('+period+'ë…„ ì ë¦½ì‹)'),
        React.createElement('table',{className:'ct'},
          React.createElement('thead',null,React.createElement('tr',null,
            React.createElement('th',null,'ìˆœìœ„'),React.createElement('th',null,'ìì‚°'),React.createElement('th',null,'ìµœì¢… ìì‚°'),React.createElement('th',null,'ì›ê¸ˆ'),React.createElement('th',null,'ìˆ˜ìµë¥ '),React.createElement('th',null,'CAGR'),React.createElement('th',null,'MDD')
          )),
          React.createElement('tbody',null,
            res.ind.map(function(r,i){
              return React.createElement('tr',{key:r.ticker},
                React.createElement('td',{style:{color:i<3?'var(--y)':'var(--t4)'}},i+1),
                React.createElement('td',{style:{color:COLORS[r.ticker],fontWeight:600}},r.label),
                React.createElement('td',{style:{color:'var(--g)',fontWeight:600}},fmt(r.finalValue)),
                React.createElement('td',{style:{color:'var(--t2)'}},fmt(r.invested)),
                React.createElement('td',{style:{color:r.totalReturn>0?'var(--g)':'var(--r)'}},fPct(r.totalReturn)),
                React.createElement('td',null,fPct(r.cagr)),
                React.createElement('td',{style:{color:'var(--r)'}},fPct(r.maxDD))
              );
            })
          )
        )
      )
    )
  );
}



/* ===== AI ê²°ê³¼ ì°¨íŠ¸ ===== */
function AIChart(props){
  var data=props.data,dates=props.dates,height=props.height||300;
  var canRef=useRef(null),wRef=useRef(null);
  var s1=useState(null),tip=s1[0],setTip=s1[1];

  useEffect(function(){
    if(!canRef.current||!wRef.current||!data||!data.length)return;
    var c=canRef.current,w=wRef.current.clientWidth,h=height;
    var dpr=window.devicePixelRatio||1;
    c.width=w*dpr;c.height=h*dpr;c.style.width=w+'px';c.style.height=h+'px';
    var ctx=c.getContext('2d');ctx.scale(dpr,dpr);
    var pad={t:12,r:12,b:28,l:62};
    var cw=w-pad.l-pad.r,ch=h-pad.t-pad.b;
    if(cw<40||ch<40)return;

    // Collect all values for Y range
    var yMin=Infinity,yMax=-Infinity;
    data.forEach(function(pt){
      var vals=[pt.value,pt.buyHold,pt.invested];
      vals.forEach(function(v){if(v<yMin)yMin=v;if(v>yMax)yMax=v;});
    });
    if(yMin===yMax){yMin*=0.9;yMax*=1.1;}
    var yP=(yMax-yMin)*0.06;yMin=Math.max(0,yMin-yP);yMax+=yP;

    var xPos=function(i){return pad.l+(i/(data.length-1))*cw;};
    var yPos=function(v){return pad.t+ch-(v-yMin)/(yMax-yMin)*ch;};

    ctx.clearRect(0,0,w,h);

    // Grid
    ctx.strokeStyle='#1a1a2e';ctx.lineWidth=1;ctx.fillStyle='#686880';ctx.font='9px JetBrains Mono,monospace';ctx.textAlign='right';
    var yStep=Math.pow(10,Math.floor(Math.log10((yMax-yMin)/4)));
    if((yMax-yMin)/yStep>8)yStep*=2;
    for(var yt=Math.ceil(yMin/yStep)*yStep;yt<=yMax;yt+=yStep){
      var yy=yPos(yt);
      ctx.beginPath();ctx.moveTo(pad.l,yy);ctx.lineTo(w-pad.r,yy);ctx.stroke();
      ctx.fillText(fmt(yt),pad.l-6,yy+3);
    }

    // X labels
    ctx.textAlign='center';
    if(dates&&dates.length){
      var lStep=Math.max(1,Math.floor(dates.length/7));
      for(var i=0;i<dates.length;i+=lStep){
        if(dates[i])ctx.fillText(dates[i].slice(0,4)+'.'+dates[i].slice(5,7),xPos(i),h-6);
      }
    }

    // Invested line (area fill)
    ctx.beginPath();ctx.moveTo(xPos(0),h-pad.b);
    data.forEach(function(pt,i){ctx.lineTo(xPos(i),yPos(pt.invested));});
    ctx.lineTo(xPos(data.length-1),h-pad.b);ctx.closePath();
    ctx.fillStyle='rgba(68,136,255,0.06)';ctx.fill();
    ctx.beginPath();ctx.strokeStyle='#4488ff55';ctx.lineWidth=1;ctx.setLineDash([]);
    data.forEach(function(pt,i){if(i===0)ctx.moveTo(xPos(i),yPos(pt.invested));else ctx.lineTo(xPos(i),yPos(pt.invested));});
    ctx.stroke();

    // Buy & hold line (dashed)
    ctx.beginPath();ctx.strokeStyle='#8888aa';ctx.lineWidth=1.5;ctx.setLineDash([6,4]);ctx.lineJoin='round';
    data.forEach(function(pt,i){if(i===0)ctx.moveTo(xPos(i),yPos(pt.buyHold));else ctx.lineTo(xPos(i),yPos(pt.buyHold));});
    ctx.stroke();ctx.setLineDash([]);

    // Strategy line (solid green, area fill)
    ctx.beginPath();ctx.moveTo(xPos(0),h-pad.b);
    data.forEach(function(pt,i){ctx.lineTo(xPos(i),yPos(pt.value));});
    ctx.lineTo(xPos(data.length-1),h-pad.b);ctx.closePath();
    var grad=ctx.createLinearGradient(0,0,0,h);
    grad.addColorStop(0,'rgba(0,255,136,0.15)');grad.addColorStop(1,'rgba(0,255,136,0.02)');
    ctx.fillStyle=grad;ctx.fill();
    ctx.beginPath();ctx.strokeStyle='#00ff88';ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';
    data.forEach(function(pt,i){if(i===0)ctx.moveTo(xPos(i),yPos(pt.value));else ctx.lineTo(xPos(i),yPos(pt.value));});
    ctx.stroke();

    // Store meta for hover
    c._meta={pad:pad,cw:cw,data:data,dates:dates,xPos:xPos,yPos:yPos};
  },[data,dates,height]);

  var handleMouse=function(e){
    if(!canRef.current||!canRef.current._meta)return;
    var rect=canRef.current.getBoundingClientRect();
    var mx=e.clientX-rect.left;
    var meta=canRef.current._meta;
    var relX=mx-meta.pad.l;
    if(relX<0||relX>meta.cw){setTip(null);return;}
    var pct=relX/meta.cw;
    var idx=Math.round(pct*(meta.data.length-1));
    idx=Math.max(0,Math.min(idx,meta.data.length-1));
    var pt=meta.data[idx];
    var dt=meta.dates&&meta.dates[idx]?meta.dates[idx]:'';
    setTip({x:e.clientX-rect.left,y:e.clientY-rect.top,pt:pt,date:dt});
  };

  if(!data||!data.length)return React.createElement('div',{style:{color:'var(--t4)',fontSize:12,padding:20,textAlign:'center'}},'ì°¨íŠ¸ ë°ì´í„° ì—†ìŒ');

  return React.createElement('div',{ref:wRef,style:{width:'100%',height:height,position:'relative'},onMouseMove:handleMouse,onMouseLeave:function(){setTip(null);}},
    React.createElement('canvas',{ref:canRef,style:{display:'block'}}),
    tip&&React.createElement('div',{style:{position:'absolute',left:Math.min(tip.x+12,(wRef.current?wRef.current.clientWidth:800)-180),top:Math.max(tip.y-90,8),background:'#0d0d16ee',border:'1px solid #282845',borderRadius:8,padding:'8px 10px',fontSize:10,pointerEvents:'none',zIndex:10,minWidth:150}},
      tip.date&&React.createElement('div',{style:{color:'#9090a8',marginBottom:4,fontFamily:'JetBrains Mono,monospace'}},tip.date),
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',gap:12,marginBottom:2}},
        React.createElement('span',{style:{color:'#00ff88',fontWeight:600}},'ì „ëµ'),
        React.createElement('span',{style:{fontFamily:'JetBrains Mono',color:'#00ff88'}},fmt(tip.pt.value))
      ),
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',gap:12,marginBottom:2}},
        React.createElement('span',{style:{color:'#8888aa'}},'ê±°ì¹˜ì‹'),
        React.createElement('span',{style:{fontFamily:'JetBrains Mono',color:'#8888aa'}},fmt(tip.pt.buyHold))
      ),
      React.createElement('div',{style:{display:'flex',justifyContent:'space-between',gap:12}},
        React.createElement('span',{style:{color:'#4488ff'}},'ì›ê¸ˆ'),
        React.createElement('span',{style:{fontFamily:'JetBrains Mono',color:'#4488ff'}},fmt(tip.pt.invested))
      )
    )
  );
}

/* ===== íƒ­: AI ì‹œë®¬ë ˆì´í„° ===== */
function AISimulator(){
  var s1=useState([]),assets=s1[0],setA=s1[1];
  var s2=useState('beat'),goal=s2[0],setGoal=s2[1];
  var s3=useState(500),budget=s3[0],setB=s3[1];
  var s4=useState(null),res=s4[0],setR=s4[1];
  var s5=useState(false),busy=s5[0],setBusy=s5[1];
  var s6=useState(0),progress=s6[0],setProg=s6[1];
  var s7=useState(''),progMsg=s7[0],setMsg=s7[1];
  var s8=useState(0),selIdx=s8[0],setSelIdx=s8[1];

  var goalLabels={beat:'ğŸ† ê±°ì¹˜ì‹ ì´ê¸°ê¸°',maxret:'ğŸ’° ìµœëŒ€ ìˆ˜ìµ',minrisk:'ğŸ›¡ï¸ ìµœì†Œ ë¦¬ìŠ¤í¬',efficiency:'âš–ï¸ ìµœì  íš¨ìœ¨'};

  function combinePortfolio(combo,weight){
    var minLen=Infinity;
    combo.forEach(function(s){if(s.curve&&s.curve.length<minLen)minLen=s.curve.length;});
    if(minLen<2||minLen===Infinity)return null;
    var combinedCurve=[];
    for(var i=0;i<minLen;i++){
      var wVal=0,wBH=0,wInv=0;
      combo.forEach(function(s){
        wVal+=s.curve[i].value*weight;
        wBH+=s.curve[i].buyHold*weight;
        wInv+=s.curve[i].invested*weight;
      });
      combinedCurve.push({value:wVal,buyHold:wBH,invested:wInv});
    }
    var last=combinedCurve[combinedCurve.length-1];
    var totalFinal=last.value,totalInvested=last.invested,totalBH=last.buyHold;
    var tr=totalInvested>0?((totalFinal-totalInvested)/totalInvested)*100:0;
    var bhR=totalInvested>0?((totalBH-totalInvested)/totalInvested)*100:0;
    var yrs=combo[0].period;
    var cagr=yrs>0?(Math.pow(Math.max(totalFinal/totalInvested,0.001),1/yrs)-1)*100:0;
    var pk=0,mdd=0;
    combinedCurve.forEach(function(pt){if(pt.value>pk)pk=pt.value;var d=pk>0?(pt.value-pk)/pk:0;if(d<mdd)mdd=d;});
    var margin=tr-bhR;
    var sharpe=mdd!==0?cagr/Math.abs(mdd):0;
    var assetInfo=combo.map(function(s){return{ticker:s.ticker,label:s.label,stratLabel:s.stratLabel};});
    // Downsample curve for chart (max 200 points)
    var step=Math.max(1,Math.floor(combinedCurve.length/200));
    var chartCurve=[];
    for(var ci=0;ci<combinedCurve.length;ci+=step){
      chartCurve.push(combinedCurve[ci]);
    }
    if(chartCurve[chartCurve.length-1]!==combinedCurve[combinedCurve.length-1])chartCurve.push(combinedCurve[combinedCurve.length-1]);
    // Get dates from first combo asset
    var chartDates=[];
    if(combo[0].curve){for(var ci=0;ci<combinedCurve.length;ci+=step){if(combo[0].curve[ci])chartDates.push(combo[0].curve[ci].date);}
    if(chartDates.length<chartCurve.length&&combo[0].curve[combinedCurve.length-1])chartDates.push(combo[0].curve[combinedCurve.length-1].date);}
    return{assets:assetInfo,period:combo[0].period,totalReturn:tr,bhReturn:bhR,margin:margin,cagr:cagr,maxDD:mdd*100,sharpe:sharpe,finalValue:totalFinal,invested:totalInvested,chartCurve:chartCurve,chartDates:chartDates};
  }

  var run=function(){
    if(!assets.length)return;
    setBusy(true);setProg(0);setR(null);
    var numAssets=assets.length;
    var weight=1/numAssets;
    var paramSets=[];
    var periods=[3,5,10,15,20,25];
    ['daily','weekly','monthly'].forEach(function(f){
      periods.forEach(function(p){paramSets.push({sType:'dca',label:'ì ë¦½ì‹ ('+({daily:'ë§¤ì¼',weekly:'ë§¤ì£¼',monthly:'ë§¤ì›”'}[f])+')',period:p,params:{budget:budget,frequency:f}});});
    });
    [50,100,150,200,250].forEach(function(ma){
      [-15,-10,-5,0,3].forEach(function(th){
        periods.forEach(function(p){paramSets.push({sType:'ma',label:'ì´í‰ì„  '+ma+'ì¼ / '+th+'%',period:p,params:{budget:budget,maPeriod:ma,maThreshold:th}});});
      });
    });
    [-5,-10,-15,-20,-25,-30].forEach(function(dip){
      [25,30,35,40].forEach(function(rsi){
        periods.forEach(function(p){paramSets.push({sType:'dip',label:'ê¸‰ë½ '+dip+'% / RSI '+rsi,period:p,params:{budget:budget,dipThreshold:dip,rsiThreshold:rsi}});});
      });
    });
    [100,200].forEach(function(ma){
      [-10,-15,-20].forEach(function(dip){
        [25,30].forEach(function(rsi){
          periods.forEach(function(p){paramSets.push({sType:'hybrid',label:'í•˜ì´ë¸Œë¦¬ë“œ MA'+ma+' / '+dip+'%',period:p,params:{budget:budget,maPeriod:ma,dipThreshold:dip,rsiThreshold:rsi}});});
        });
      });
    });

    setTimeout(function(){
      setMsg('Phase 1: ìì‚°ë³„ ì „ëµ ë¶„ì„ ì¤‘...');
      var perAssetByPeriod={};
      assets.forEach(function(tk){
        perAssetByPeriod[tk]={};
        paramSets.forEach(function(ps){
          var sd=getStart(ps.period);
          var r=runStrategy(tk,ps.sType,ps.params,sd,null);
          if(!r)return;
          if(!perAssetByPeriod[tk][ps.period])perAssetByPeriod[tk][ps.period]=[];
          perAssetByPeriod[tk][ps.period].push({
            ticker:tk,label:r.label,sType:ps.sType,stratLabel:ps.label,
            period:ps.period,curve:r.curve,finalValue:r.finalValue,
            invested:r.invested,totalReturn:r.totalReturn,bhReturn:r.bhReturn,
            cagr:r.cagr,maxDD:r.maxDD,params:ps.params
          });
        });
      });
      setProg(30);

      setMsg('Phase 2: í¬íŠ¸í´ë¦¬ì˜¤ ì¡°í•© ë¶„ì„ ì¤‘...');
      var allResults=[];

      if(numAssets===1){
        var tk=assets[0];
        Object.keys(perAssetByPeriod[tk]).forEach(function(p){
          (perAssetByPeriod[tk][p]||[]).forEach(function(r){
            var margin=r.totalReturn-r.bhReturn;
            var sharpe=r.maxDD!==0?r.cagr/Math.abs(r.maxDD):0;
            // Downsample curve
            var step2=Math.max(1,Math.floor(r.curve.length/200));
            var cc=[],cd=[];
            for(var ci=0;ci<r.curve.length;ci+=step2){cc.push({value:r.curve[ci].value,buyHold:r.curve[ci].buyHold,invested:r.curve[ci].invested});cd.push(r.curve[ci].date);}
            if(cc.length>0&&cc[cc.length-1].value!==r.curve[r.curve.length-1].value){cc.push({value:r.curve[r.curve.length-1].value,buyHold:r.curve[r.curve.length-1].buyHold,invested:r.curve[r.curve.length-1].invested});cd.push(r.curve[r.curve.length-1].date);}
            allResults.push({
              assets:[{ticker:r.ticker,label:r.label,stratLabel:r.stratLabel}],
              period:parseInt(p),totalReturn:r.totalReturn,bhReturn:r.bhReturn,
              margin:margin,cagr:r.cagr,maxDD:r.maxDD,sharpe:sharpe,
              finalValue:r.finalValue,invested:r.invested,
              chartCurve:cc,chartDates:cd
            });
          });
        });
      }else{
        var TOP_N=numAssets<=3?15:8;
        periods.forEach(function(period){
          var topPerAsset=[];
          var allHaveData=true;
          assets.forEach(function(tk){
            var arr=perAssetByPeriod[tk][period];
            if(!arr||!arr.length){allHaveData=false;return;}
            arr.sort(function(a,b){return b.totalReturn-a.totalReturn;});
            topPerAsset.push(arr.slice(0,TOP_N));
          });
          if(!allHaveData||topPerAsset.length!==numAssets)return;

          if(numAssets===2){
            for(var i=0;i<topPerAsset[0].length;i++){
              for(var j=0;j<topPerAsset[1].length;j++){
                var cr=combinePortfolio([topPerAsset[0][i],topPerAsset[1][j]],weight);
                if(cr)allResults.push(cr);
              }
            }
          }else if(numAssets===3){
            for(var i=0;i<topPerAsset[0].length;i++){
              for(var j=0;j<topPerAsset[1].length;j++){
                for(var k=0;k<topPerAsset[2].length;k++){
                  var cr=combinePortfolio([topPerAsset[0][i],topPerAsset[1][j],topPerAsset[2][k]],weight);
                  if(cr)allResults.push(cr);
                }
              }
            }
          }else{
            var maxPer=5;
            var indices=assets.map(function(){return 0;});
            var maxIter=Math.pow(maxPer,numAssets);
            for(var iter=0;iter<maxIter;iter++){
              var combo=[];var valid=true;
              for(var a=0;a<numAssets;a++){
                if(indices[a]>=topPerAsset[a].length){valid=false;break;}
                combo.push(topPerAsset[a][indices[a]]);
              }
              if(valid){var cr=combinePortfolio(combo,weight);if(cr)allResults.push(cr);}
              var carry=true;
              for(var a=numAssets-1;a>=0&&carry;a--){
                indices[a]++;
                if(indices[a]>=maxPer){indices[a]=0;}else{carry=false;}
              }
              if(carry)break;
            }
          }
        });
      }
      setProg(80);setMsg('ê²°ê³¼ ì •ë ¬ ì¤‘...');

      if(goal==='beat'){
        allResults=allResults.filter(function(r){return r.margin>0;});
        allResults.sort(function(a,b){return b.margin-a.margin;});
      }else if(goal==='maxret'){
        allResults.sort(function(a,b){return b.totalReturn-a.totalReturn;});
      }else if(goal==='minrisk'){
        allResults.sort(function(a,b){return b.maxDD-a.maxDD;});
      }else{
        allResults.sort(function(a,b){return b.sharpe-a.sharpe;});
      }

      setProg(100);
      setSelIdx(0);
      setR({top:allResults.slice(0,30),totalTested:allResults.length,totalFound:allResults.length,goal:goal,numAssets:numAssets});
      setBusy(false);
    },20);
  };

  var goalDefs=[
    {id:'beat',l:'ğŸ† ê±°ì¹˜ì‹ ì´ê¸°ê¸°',d:'í¬íŠ¸í´ë¦¬ì˜¤ê°€ ê±°ì¹˜ì‹ë³´ë‹¤ ë†’ì€ ìˆ˜ìµ'},
    {id:'maxret',l:'ğŸ’° ìµœëŒ€ ìˆ˜ìµ',d:'ì ˆëŒ€ ìˆ˜ìµë¥  ìµœëŒ€í™”'},
    {id:'minrisk',l:'ğŸ›¡ï¸ ìµœì†Œ ë¦¬ìŠ¤í¬',d:'ìµœëŒ€ ë‚™í­ ìµœì†Œí™”'},
    {id:'efficiency',l:'âš–ï¸ ìµœì  íš¨ìœ¨',d:'ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµ ìµœì í™”'}
  ];

  var weightPct=assets.length>0?Math.round(100/assets.length):0;
  var btnText=busy?'ë¶„ì„ ì¤‘...':'ğŸ¤– AI ë¶„ì„ ì‹œì‘';
  if(!busy&&assets.length){
    btnText='ğŸ¤– AI ë¶„ì„ ì‹œì‘ ('+assets.length+'ê°œ ìì‚°';
    if(assets.length>1)btnText+=' Â· ê· ë“± '+weightPct+'%';
    btnText+=')';
  }

  // Build elements array for return
  var els=[];

  // Help box
  els.push(React.createElement(HelpBox,{key:'help'},
    React.createElement('div',{className:'hitem'},React.createElement('b',null,'ì‚¬ìš©ë²•: '),'ìì‚°ì„ ì„ íƒí•˜ê³  ëª©í‘œë¥¼ ì„¤ì •í•œ ë’¤ ',React.createElement('span',{style:{color:'var(--g)',fontWeight:600}},'AI ë¶„ì„ ì‹œì‘'),' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.'),
    React.createElement('div',{style:{marginTop:10,marginBottom:4,fontWeight:600,color:'var(--t1)',fontSize:11}},'ì‘ë™ ë°©ì‹'),
    React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'1ê°œ'),' í•´ë‹¹ ìì‚°ì— 100% íˆ¬ì, ëª¨ë“  ì „ëµÂ·ë§¤ê°œë³€ìˆ˜Â·ê¸°ê°„ ì¡°í•© í…ŒìŠ¤íŠ¸'),
    React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'2ê°œ'),' 50:50 ê· ë“± ë°°ë¶„, ê° ìì‚°ë³„ ìµœì  ì „ëµì„ ë…ë¦½ì ìœ¼ë¡œ íƒìƒ‰'),
    React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'3ê°œ'),' 33:33:33 ê· ë“± ë°°ë¶„'),
    React.createElement('div',{className:'hitem'},React.createElement('span',{className:'tag'},'4~5ê°œ'),' ê· ë“± ë°°ë¶„ (20~25%), ê° ìì‚°ì— ì„œë¡œ ë‹¤ë¥¸ ì „ëµ ì ìš© ê°€ëŠ¥'),
    React.createElement('div',{className:'hitem',style:{marginTop:6}},'âš¡ AIê°€ ìì‚°ë³„ ìˆ˜ë°± ê°œ ì „ëµì„ í…ŒìŠ¤íŠ¸í•œ í›„, ìƒìœ„ ì „ëµì„ ì¡°í•©í•˜ì—¬ ìµœì ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.'),
    React.createElement('div',{className:'hitem'},'ì˜ˆì‹œ: ë¹„íŠ¸ì½”ì¸ + ê¸ˆ + SPY â†’ ë¹„íŠ¸ì½”ì¸ì€ ê¸‰ë½ ë§¤ìˆ˜, ê¸ˆì€ ì›” ì ë¦½ì‹, SPYëŠ” í•˜ì´ë¸Œë¦¬ë“œì²˜ëŸ¼ ê° ìì‚°ì— ì„œë¡œ ë‹¤ë¥¸ ì „ëµì´ ì ìš©ë©ë‹ˆë‹¤.'),
    React.createElement('div',{className:'hitem',style:{color:'var(--t3)',fontSize:10}},'âš¡ ìµœëŒ€ 5ê°œ ìì‚°ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤')
  ));

  // Hero
  els.push(React.createElement('div',{key:'hero',style:{textAlign:'center',padding:'28px 0 20px'}},
    React.createElement('h2',{style:{fontSize:28,fontWeight:800,background:'linear-gradient(135deg,#00ff88,#4488ff,#aa66ff)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',marginBottom:6}},'ğŸ¤– AI ì‹œë®¬ë ˆì´í„°'),
    React.createElement('p',{style:{color:'var(--t2)',fontSize:13,maxWidth:500,margin:'0 auto'}},'ìˆ˜ë°± ê°œì˜ ì „ëµ ì¡°í•©ì„ ìë™ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ìµœì ì˜ íˆ¬ì ì „ëµì„ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤')
  ));

  // Controls
  var assetBox=React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16}},
    React.createElement('div',{className:'stitle',style:{marginTop:0}},'ìì‚° ì„ íƒ (ìµœëŒ€ 5ê°œ)'),
    assets.length>1?React.createElement('div',{style:{fontSize:10,color:'var(--g)',marginBottom:8,fontFamily:'JetBrains Mono'}},'ê· ë“± ë°°ë¶„: ìì‚°ë‹¹ '+weightPct+'%'):null,
    React.createElement(AssetSel,{sel:assets,onChange:setA,max:5})
  );

  var goalBox=React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16,marginBottom:12}},
    React.createElement('div',{className:'stitle',style:{marginTop:0}},'ë¶„ì„ ëª©í‘œ'),
    goalDefs.map(function(g){
      return React.createElement('div',{key:g.id,className:'sbtn'+(goal===g.id?' on':''),onClick:function(){setGoal(g.id);}},
        React.createElement('span',{className:'lb'},g.l),
        React.createElement('span',{className:'ds'},g.d)
      );
    })
  );

  var budgetLabel='$'+budget;
  if(assets.length>1)budgetLabel+=' (ìì‚°ë‹¹ $'+Math.round(budget/assets.length)+')';
  var budgetBox=React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16}},
    React.createElement('div',{className:'stitle',style:{marginTop:0}},'ì›” íˆ¬ìê¸ˆ'),
    React.createElement('div',{className:'sgrp',style:{marginBottom:0}},
      React.createElement('div',{className:'shdr'},React.createElement('span',{className:'slbl'},''),React.createElement('span',{className:'sval'},budgetLabel)),
      React.createElement('input',{type:'range',min:100,max:5000,step:100,value:budget,onChange:function(e){setB(+e.target.value);}})
    )
  );

  var rightCol=React.createElement('div',null,goalBox,budgetBox);
  var grid=React.createElement('div',{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(280px,1fr))',gap:20,marginBottom:20}},assetBox,rightCol);
  var runBtn=React.createElement('button',{
    style:{width:'100%',padding:14,background:assets.length?'linear-gradient(135deg,#00ff88,#4488ff)':'#333',border:'none',borderRadius:9,fontSize:15,fontWeight:700,color:assets.length?'#000':'#666',cursor:assets.length?'pointer':'not-allowed',fontFamily:'inherit',transition:'.3s',marginBottom:20},
    onClick:run,disabled:!assets.length||busy
  },btnText);

  els.push(React.createElement('div',{key:'ctrl',style:{maxWidth:900,margin:'0 auto'}},grid,runBtn));

  // Progress bar
  if(busy){
    els.push(React.createElement('div',{key:'prog',style:{maxWidth:900,margin:'0 auto 20px'}},
      React.createElement('div',{style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:9,padding:16}},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',marginBottom:8}},
          React.createElement('span',{style:{fontSize:12,color:'var(--t2)'}},progMsg),
          React.createElement('span',{style:{fontSize:12,fontFamily:'JetBrains Mono',color:'var(--g)',fontWeight:700}},progress+'%')
        ),
        React.createElement('div',{style:{height:6,background:'var(--bg4)',borderRadius:3,overflow:'hidden'}},
          React.createElement('div',{style:{height:'100%',width:progress+'%',background:'linear-gradient(90deg,#00ff88,#4488ff)',borderRadius:3,transition:'width .2s'}})
        )
      )
    ));
  }

  // Results
  if(res&&!busy){
    var resEls=[];

    // Summary banner
    var bannerBg=res.goal==='beat'&&res.totalFound>0?'linear-gradient(135deg,rgba(0,255,136,.08),rgba(68,136,255,.08))':'var(--bg2)';
    var bannerBorder=res.goal==='beat'&&res.totalFound>0?'#00ff8840':'var(--bdr)';
    var bannerChildren=[];
    if(res.goal==='beat'){
      if(res.totalFound>0){
        bannerChildren.push(React.createElement('div',{key:'t',style:{fontSize:20,fontWeight:800,color:'var(--g)',marginBottom:4}},'âœ… ê±°ì¹˜ì‹ì„ ì´ê¸´ ì „ëµ '+res.totalFound.toLocaleString()+'ê°œ ë°œê²¬!'));
      }else{
        bannerChildren.push(React.createElement('div',{key:'t',style:{fontSize:20,fontWeight:800,color:'var(--r)',marginBottom:4}},'âŒ ëª¨ë“  ì¡°í•©ì—ì„œ ê±°ì¹˜ì‹ì´ ìš°ì„¸í•©ë‹ˆë‹¤'));
      }
    }else{
      bannerChildren.push(React.createElement('div',{key:'t',style:{fontSize:20,fontWeight:800,color:'var(--g)',marginBottom:4}},goalLabels[res.goal]+' â€” ë¶„ì„ ì™„ë£Œ'));
    }
    var subText=(res.numAssets>1?res.numAssets+'ê°œ ìì‚° ê· ë“± ë°°ë¶„ ('+weightPct+'%) Â· ':'')+res.totalTested.toLocaleString()+'ê°œ ì¡°í•© ë¶„ì„ ì™„ë£Œ';
    bannerChildren.push(React.createElement('div',{key:'s',style:{fontSize:12,color:'var(--t2)'}},subText));
    resEls.push(React.createElement('div',{key:'banner',style:{background:bannerBg,border:'1px solid '+bannerBorder,borderRadius:11,padding:20,textAlign:'center',marginBottom:20}},bannerChildren));

    // Top 6 cards
    if(res.top.length>0){
      var medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰','4','5','6'];
      var mColors=['var(--y)','#c0c0c0','#cc8844','var(--t3)','var(--t3)','var(--t3)'];
      var cards=res.top.slice(0,6).map(function(r,idx){
        var cardEls=[];
        cardEls.push(React.createElement('div',{key:'hd',style:{display:'flex',alignItems:'center',gap:8,marginBottom:10}},
          React.createElement('span',{style:{fontSize:idx<3?20:14,fontWeight:800,color:mColors[idx]}},medals[idx]),
          React.createElement('span',{style:{fontSize:12,fontWeight:700,color:'var(--t1)'}},r.period+'ë…„')
        ));
        r.assets.forEach(function(a,ai){
          cardEls.push(React.createElement('div',{key:'a'+ai,style:{display:'flex',alignItems:'center',gap:6,marginBottom:4}},
            React.createElement('div',{style:{width:6,height:6,borderRadius:2,background:COLORS[a.ticker]}}),
            React.createElement('span',{style:{fontSize:11,color:COLORS[a.ticker],fontWeight:600}},a.label.split(' (')[0]),
            React.createElement('span',{style:{fontSize:10,color:'var(--t3)',fontFamily:'JetBrains Mono'}},a.stratLabel)
          ));
        });
        var statsEls=[];
        statsEls.push(React.createElement('div',{key:'ret'},
          React.createElement('div',{style:{fontSize:9,color:'var(--t4)'}},'ìˆ˜ìµë¥ '),
          React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:17,fontWeight:700,color:r.totalReturn>0?'var(--g)':'var(--r)'}},fPct(r.totalReturn))
        ));
        if(res.goal==='beat'){
          statsEls.push(React.createElement('div',{key:'margin'},
            React.createElement('div',{style:{fontSize:9,color:'var(--t4)'}},'ê±°ì¹˜ì‹ ëŒ€ë¹„'),
            React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:17,fontWeight:700,color:r.margin>0?'var(--g)':'var(--r)'}},(r.margin>0?'â–²':'â–¼')+Math.abs(r.margin).toFixed(1)+'%')
          ));
        }
        statsEls.push(React.createElement('div',{key:'cagr'},
          React.createElement('div',{style:{fontSize:9,color:'var(--t4)'}},'CAGR'),
          React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:17,fontWeight:700,color:'var(--t1)'}},fPct(r.cagr))
        ));
        statsEls.push(React.createElement('div',{key:'mdd'},
          React.createElement('div',{style:{fontSize:9,color:'var(--t4)'}},'MDD'),
          React.createElement('div',{style:{fontFamily:'JetBrains Mono',fontSize:17,fontWeight:700,color:'var(--r)'}},fPct(r.maxDD))
        ));
        cardEls.push(React.createElement('div',{key:'stats',style:{display:'flex',gap:14,marginTop:10,paddingTop:10,borderTop:'1px solid var(--bdr)'}},statsEls));
        return React.createElement('div',{key:idx,style:{background:'var(--bg2)',border:'1px solid '+(idx<3?mColors[idx]+'40':'var(--bdr)'),borderRadius:10,padding:16}},cardEls);
      });
      resEls.push(React.createElement('div',{key:'cards',style:{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:12,marginBottom:20}},cards));
    }

    // Chart for selected result
    if(res.top.length>0){
      var sel=res.top[selIdx]||res.top[0];
      var chartTitle=sel.assets.map(function(a){return a.label.split(' (')[0]+': '+a.stratLabel;}).join(' + ');
      resEls.push(React.createElement('div',{key:'chart',style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:20,marginBottom:20}},
        React.createElement('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:4,flexWrap:'wrap',gap:8}},
          React.createElement('div',{style:{fontSize:14,fontWeight:700,color:'var(--t1)'}},'ğŸ“ˆ ì „ëµ ì„±ê³¼ ì°¨íŠ¸'),
          React.createElement('div',{style:{fontSize:11,color:'var(--t2)'}},'#'+(selIdx+1)+' Â· '+sel.period+'ë…„')
        ),
        React.createElement('div',{style:{fontSize:11,color:'var(--t3)',marginBottom:12}},chartTitle),
        React.createElement('div',{style:{display:'flex',gap:16,marginBottom:10}},
          React.createElement('div',{style:{display:'flex',alignItems:'center',gap:5,fontSize:10}},
            React.createElement('div',{style:{width:14,height:3,borderRadius:2,background:'#00ff88'}}),
            React.createElement('span',{style:{color:'#00ff88',fontWeight:600}},'ì „ëµ')
          ),
          React.createElement('div',{style:{display:'flex',alignItems:'center',gap:5,fontSize:10}},
            React.createElement('div',{style:{width:14,height:3,borderRadius:2,background:'#8888aa',borderTop:'1px dashed #8888aa'}}),
            React.createElement('span',{style:{color:'#8888aa'}},'ê±°ì¹˜ì‹')
          ),
          React.createElement('div',{style:{display:'flex',alignItems:'center',gap:5,fontSize:10}},
            React.createElement('div',{style:{width:14,height:3,borderRadius:2,background:'#4488ff55'}}),
            React.createElement('span',{style:{color:'#4488ff'}},'ì›ê¸ˆ')
          )
        ),
        React.createElement(AIChart,{data:sel.chartCurve,dates:sel.chartDates,height:300}),
        React.createElement('div',{style:{fontSize:10,color:'var(--t4)',marginTop:8,textAlign:'center'}},'ì•„ë˜ í‘œì—ì„œ ë‹¤ë¥¸ ì „ëµì„ í´ë¦­í•˜ë©´ ì°¨íŠ¸ê°€ ë°”ë€ë‹ˆë‹¤ â†“')
      ));
    }

    // Full table
    if(res.top.length>0){
      var ths=[React.createElement('th',{key:'r'},'ìˆœìœ„'),React.createElement('th',{key:'s'},res.numAssets>1?'í¬íŠ¸í´ë¦¬ì˜¤ ì „ëµ':'ì „ëµ'),React.createElement('th',{key:'p'},'ê¸°ê°„'),React.createElement('th',{key:'v'},'ìµœì¢… ìì‚°'),React.createElement('th',{key:'tr'},'ìˆ˜ìµë¥ ')];
      if(res.goal==='beat'){ths.push(React.createElement('th',{key:'bh'},'ê±°ì¹˜ì‹'));ths.push(React.createElement('th',{key:'m'},'ì°¨ì´'));}
      ths.push(React.createElement('th',{key:'c'},'CAGR'));
      ths.push(React.createElement('th',{key:'d'},'MDD'));

      var rows=res.top.map(function(r,i){
        var isSelected=i===selIdx;
        var tds=[
          React.createElement('td',{key:'r',style:{color:i<3?'var(--y)':'var(--t4)'}},i+1),
          React.createElement('td',{key:'s',style:{fontSize:10,maxWidth:280}},
            r.assets.map(function(a,ai){
              return React.createElement('span',{key:ai},
                React.createElement('span',{style:{color:COLORS[a.ticker],fontWeight:600}},a.label.split(' (')[0]),
                React.createElement('span',{style:{color:'var(--t3)'}},':'+a.stratLabel),
                ai<r.assets.length-1?' + ':''
              );
            })
          ),
          React.createElement('td',{key:'p'},r.period+'ë…„'),
          React.createElement('td',{key:'v',style:{color:'var(--g)',fontWeight:600}},fmt(r.finalValue)),
          React.createElement('td',{key:'tr',style:{color:r.totalReturn>0?'var(--g)':'var(--r)'}},fPct(r.totalReturn))
        ];
        if(res.goal==='beat'){
          tds.push(React.createElement('td',{key:'bh',style:{color:'var(--t2)'}},fPct(r.bhReturn)));
          tds.push(React.createElement('td',{key:'m',style:{color:r.margin>0?'var(--g)':'var(--r)',fontWeight:600}},(r.margin>0?'â–²':'â–¼')+Math.abs(r.margin).toFixed(1)+'%'));
        }
        tds.push(React.createElement('td',{key:'c'},fPct(r.cagr)));
        tds.push(React.createElement('td',{key:'d',style:{color:'var(--r)'}},fPct(r.maxDD)));
        return React.createElement('tr',{key:i,onClick:function(){setSelIdx(i);},style:{cursor:'pointer',background:isSelected?'rgba(0,255,136,.06)':'transparent',borderLeft:isSelected?'2px solid var(--g)':'2px solid transparent'}},tds);
      });

      resEls.push(React.createElement('div',{key:'table',style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16,maxHeight:560,overflowY:'auto'}},
        React.createElement('div',{style:{fontSize:13,fontWeight:600,marginBottom:10}},'ì „ì²´ ê²°ê³¼ (ìƒìœ„ '+Math.min(res.top.length,30)+'ê°œ)'),
        React.createElement('table',{className:'ct'},
          React.createElement('thead',null,React.createElement('tr',null,ths)),
          React.createElement('tbody',null,rows)
        )
      ));
    }

    // Insight box
    if(res.goal==='beat'){
      var insightText;
      if(res.totalFound>0){
        insightText=res.numAssets>1?
          'ì—¬ëŸ¬ ìì‚°ì„ ì¡°í•©í•˜ë©´ ê°œë³„ ìì‚°ë³´ë‹¤ ê±°ì¹˜ì‹ì„ ì´ê¸¸ í™•ë¥ ì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ì„œë¡œ ë‹¤ë¥¸ ìì‚°ì´ ë‹¤ë¥¸ ì‹œê¸°ì— í•˜ë½í•˜ë¯€ë¡œ, ë¶„ì‚° íˆ¬ì + ì „ëµ ë§¤ìˆ˜ì˜ ì‹œë„ˆì§€ê°€ ë°œìƒí•©ë‹ˆë‹¤. íŠ¹íˆ ë³€ë™ì„±ì´ í° ìì‚°(ë¹„íŠ¸ì½”ì¸, ì‹ í¥êµ­)ê³¼ ì•ˆì • ìì‚°(ê¸ˆ, ë¯¸êµ­ì±„)ì„ í•¨ê»˜ ì‚¬ìš©í•  ë•Œ íš¨ê³¼ì ì…ë‹ˆë‹¤.':
          'ê±°ì¹˜ì‹ì„ ì´ê¸°ëŠ” í•µì‹¬ì€ í•˜ë½ì¥ì—ì„œ ë” ë§ì´ ë§¤ìˆ˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê¸‰ë½ ë§¤ìˆ˜ì™€ í•˜ì´ë¸Œë¦¬ë“œ ì „ëµì´ ê°€ì¥ íš¨ê³¼ì ì´ë©°, íŠ¹íˆ 2008 ê¸ˆìœµìœ„ê¸°ë‚˜ ì½”ë¡œë‚˜ í­ë½ì„ í¬í•¨í•œ ê¸°ê°„ì—ì„œ ì ë¦½ì‹/ì „ëµ ë§¤ìˆ˜ì˜ ì¥ì ì´ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤.';
      }else{
        insightText='ì„ íƒí•œ ìì‚°ê³¼ ê¸°ê°„ì—ì„œëŠ” ê±°ì¹˜ì‹ì´ ëª¨ë“  ì „ëµì„ ì•ì„°ìŠµë‹ˆë‹¤. ì´ëŠ” í•´ë‹¹ ê¸°ê°„ì´ ê°•í•œ ìƒìŠ¹ì¥ì´ì—ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ê¸°ê°„ì´ë‚˜ ë³€ë™ì„±ì´ í° ìì‚°(ì˜ˆ: ë¹„íŠ¸ì½”ì¸, ì‹ í¥êµ­)ì„ ì¶”ê°€í•´ë³´ì„¸ìš”. ë¶„ì‚° íˆ¬ìê°€ ê±°ì¹˜ì‹ì„ ì´ê¸¸ í™•ë¥ ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.';
      }
      resEls.push(React.createElement('div',{key:'insight',style:{background:'var(--bg2)',border:'1px solid var(--bdr)',borderRadius:11,padding:16,marginTop:16}},
        React.createElement('div',{style:{fontSize:13,fontWeight:700,marginBottom:8,color:'var(--t1)'}},'ğŸ’¡ ë¶„ì„ ì¸ì‚¬ì´íŠ¸'),
        React.createElement('div',{style:{fontSize:12,color:'var(--t2)',lineHeight:1.8}},insightText)
      ));
    }

    els.push(React.createElement('div',{key:'results',style:{maxWidth:1200,margin:'0 auto'}},resEls));
  }

  return React.createElement('div',null,els);
}

/* ===== ì•± ===== */
function App(){
  var s1=useState(3),tab=s1[0],setTab=s1[1];
  return React.createElement('div',null,
    React.createElement('div',{className:'hdr'},
      React.createElement('div',{className:'logo'},
        React.createElement('div',{className:'logo-t'},'ì „ëµ ì—°êµ¬')
      ),
      React.createElement('div',{className:'tabs'},
        ['ğŸ“Š ì‹œë®¬ë ˆì´í„°','ğŸ¤– AI ì‹œë®¬ë ˆì´í„°','â° íƒ€ì„ë¨¸ì‹ ','ğŸ¤· ë¬´ì§€ì„± í¬íŠ¸í´ë¦¬ì˜¤'].map(function(t,i){
          return React.createElement('button',{key:i,className:'tab'+(tab===i?' on':''),onClick:function(){setTab(i);}},t);
        })
      )
    ),
    React.createElement('div',{className:'main'},
      tab===0&&React.createElement(Simulator,null),
      tab===1&&React.createElement(AISimulator,null),
      tab===2&&React.createElement(TimeMachine,null),
      tab===3&&React.createElement(BestPortfolios,null)
    )
  );
}

ReactDOM.render(React.createElement(App,null),document.getElementById('root'));
</script>
<script>
setInterval(function(){
  if(window.parent!==window){
    window.parent.postMessage({type:'resize',height:document.body.scrollHeight},'*');
  }
},300);
</script>
</body>
</html>
